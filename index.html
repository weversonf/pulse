<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PULSE v02</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        
        .pulse-check input:checked + div { background-color: #2563eb; border-color: #2563eb; }
        .pulse-check input:checked + div svg { opacity: 1; }
        .pulse-check input:checked ~ p { text-decoration: line-through; color: #64748b; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #3b82f6; cursor: pointer; margin-top: -8px; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #1e293b; border-radius: 2px; }
        
        ::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; opacity: 0.5; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 italic selection:bg-blue-500/30 pb-28">

    <!-- Cabe√ßalho Principal -->
    <header class="bg-slate-900/80 backdrop-blur-xl sticky top-0 z-50 px-6 py-5 flex items-center justify-between border-b border-white/5">
        <div>
            <h1 class="text-2xl font-black tracking-tighter text-blue-500 leading-none">PULSE</h1>
            <h2 id="current-location" class="text-[9px] font-black uppercase tracking-[0.3em] text-slate-500 mt-1 leading-none">FORTALEZA ‚Ä¢ ACTIVO</h2>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="addMonster()" class="w-12 h-12 rounded-2xl bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center text-emerald-400 active:scale-90 transition-all shadow-[0_0_15px_rgba(16,185,129,0.2)]">
                <i data-lucide="zap" class="w-6 h-6"></i>
            </button>
            <button onclick="openTab('config')" class="w-12 h-12 rounded-2xl bg-slate-800 border border-white/5 flex items-center justify-center text-slate-400 active:scale-90 transition-all">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
        </div>
    </header>

    <main class="max-w-lg mx-auto p-4 space-y-6">

        <!-- 1. DASHBOARD -->
        <section id="dashboard" class="tab-content active space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-emerald-950/40 border border-emerald-500/20 p-5 rounded-[2rem] relative overflow-hidden flex flex-col justify-end min-h-[140px] shadow-[0_0_15px_rgba(16,185,129,0.1)]">
                    <p class="text-3xl font-black tracking-tighter leading-none mb-1 text-emerald-400"><span class="text-sm">R$</span><span id="dash-saldo">0</span></p>
                    <p class="text-[9px] font-black uppercase tracking-widest text-emerald-500/60 leading-none">Saldo</p>
                    <i data-lucide="wallet" class="absolute -right-4 -top-4 w-24 h-24 text-emerald-500 opacity-10"></i>
                </div>
                <div class="bg-indigo-950/40 border border-indigo-500/20 p-5 rounded-[2rem] relative overflow-hidden flex flex-col justify-end min-h-[140px]">
                    <p class="text-3xl font-black tracking-tighter leading-none mb-1 text-indigo-400"><span class="text-sm">R$</span><span id="dash-fundo">0</span></p>
                    <p class="text-[9px] font-black uppercase tracking-widest text-indigo-500/60 leading-none">Fundo Rota</p>
                    <i data-lucide="map" class="absolute -right-4 -top-4 w-24 h-24 text-indigo-500 opacity-10"></i>
                </div>
            </div>

            <div class="bg-slate-900 border border-white/5 p-6 rounded-[2.5rem] shadow-lg cursor-pointer" onclick="openTab('bike')">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2.5 bg-blue-500/10 rounded-xl text-blue-500"><i data-lucide="bike" class="w-5 h-5"></i></div>
                    <p class="text-[10px] font-black uppercase tracking-widest text-blue-400"><span id="dash-consumo-moto">29</span> KM/L</p>
                </div>
                <p class="text-4xl font-black tracking-tighter leading-none mb-2 text-white"><span id="dash-km-atual">0</span><span class="text-xs ml-1 text-slate-600 font-bold uppercase">KM</span></p>
                <div class="w-full bg-slate-950 h-1.5 rounded-full overflow-hidden mb-2">
                    <div id="dash-oil-bar" class="bg-orange-500 h-full transition-all" style="width: 0%"></div>
                </div>
                <p id="dash-oil-text" class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-500">√ìLEO EM 5000 KM</p>
            </div>

            <div class="bg-slate-900/40 p-6 rounded-[2.5rem] border border-white/5">
                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 mb-4 flex items-center gap-2">
                    <i data-lucide="bell" class="w-3 h-3 text-red-500"></i> Alertas do Sistema
                </p>
                <ul class="space-y-3" id="dash-docs-list"></ul>
            </div>
        </section>

        <!-- 2. BIOMETRIA -->
        <section id="saude" class="tab-content space-y-4">
            <div class="bg-slate-900 border border-white/5 p-6 rounded-[2.5rem] flex flex-col justify-between min-h-[160px]">
                <div class="space-y-4 mb-6">
                    <div>
                        <div class="flex justify-between text-[9px] font-black uppercase tracking-widest text-blue-500 mb-2 leading-none">
                            <span>Hidrata√ß√£o Total (<span id="water-goal-text">0</span>ml)</span>
                            <span id="water-percent-text">0%</span>
                        </div>
                        <div class="w-full bg-slate-950 h-2 rounded-full overflow-hidden shadow-inner">
                            <div id="water-bar" class="bg-blue-500 h-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="addWaterWork()" class="bg-blue-600 p-4 rounded-3xl active:scale-95 transition-all shadow-xl text-center text-xs font-black uppercase">Trabalho</button>
                    <button onclick="addWaterHome()" class="bg-slate-800 p-4 rounded-3xl border border-white/5 active:scale-95 transition-all text-xs font-black uppercase">Casa</button>
                </div>
                <button onclick="resetWater()" class="w-full mt-4 text-[9px] uppercase tracking-widest text-slate-500 font-bold">Reset di√°rio</button>
            </div>

            <div class="bg-slate-900/40 p-6 rounded-[2.5rem] border border-white/5 relative overflow-hidden">
                <div class="flex justify-between items-center mb-4 relative z-10">
                    <p class="text-[10px] font-black uppercase tracking-[0.3em] text-emerald-500">N√≠vel Cafe√≠na</p>
                    <p class="font-black text-xl"><span id="monster-count">0</span><span class="text-[10px] text-slate-500 uppercase ml-1">Latas</span></p>
                </div>
                <div class="w-full bg-slate-950 h-1.5 rounded-full overflow-hidden mb-2 relative z-10">
                    <div id="caf-bar" class="bg-emerald-500 h-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </section>

        <!-- 3. VE√çCULO (FAZER 250) -->
        <section id="bike" class="tab-content space-y-4">
            <div class="bg-blue-600 p-6 rounded-[2.5rem] shadow-lg shadow-blue-500/20 relative overflow-hidden flex items-center justify-between">
                <div class="z-10 relative">
                    <h3 id="bike-header-name" class="font-black text-2xl uppercase tracking-tighter text-white leading-none">Fazer 250</h3>
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-200 mt-1 leading-none">Gest√£o de Ve√≠culo</p>
                </div>
                <i data-lucide="bike" class="absolute -right-2 -bottom-2 w-24 h-24 text-blue-800 opacity-30"></i>
            </div>

            <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5">
                <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-orange-500 mb-4 flex items-center gap-2"><i data-lucide="wrench" class="w-4 h-4 text-orange-500"></i> Lan√ßar Servi√ßo</h3>
                <div class="space-y-3">
                    <select id="servico-tipo" onchange="toggleServicoFields()" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                        <option value="Abastecimento">‚õΩ Abastecimento</option>
                        <option value="Troca de √ìleo">üõ¢Ô∏è Troca de √ìleo</option>
                        <option value="Manuten√ß√£o">üîß Manuten√ß√£o Geral</option>
                    </select>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" id="servico-km" placeholder="KM Atual" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                        <input type="number" id="servico-valor" placeholder="Valor Total" oninput="calcCombustivel('valor')" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                    </div>
                    <div id="campos-abastecimento" class="grid grid-cols-2 gap-3 transition-all">
                        <select id="servico-combustivel" class="w-full col-span-2 p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                            <option value="Gasolina Comum">Gasolina Comum</option>
                            <option value="Gasolina Aditivada">Gasolina Aditivada</option>
                        </select>
                        <input type="number" id="servico-preco-litro" placeholder="R$/Litro" oninput="calcCombustivel('preco')" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                        <input type="number" id="servico-litros" placeholder="Total Litros" oninput="calcCombustivel('litros')" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                    </div>
                    <button onclick="lancarServico()" class="w-full bg-slate-800 text-slate-300 py-4 rounded-2xl font-black uppercase tracking-widest text-[10px] shadow-xl">Registrar</button>
                </div>
            </div>

            <div class="bg-slate-900/40 p-6 rounded-[2.5rem] border border-white/5">
                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 mb-4 flex items-center gap-2"><i data-lucide="history" class="w-4 h-4 text-slate-500"></i> Hist√≥rico de Servi√ßos</p>
                <div class="space-y-3" id="bike-history-list"></div>
            </div>
        </section>

        <!-- 4. MAKRO ENG. (TRABALHO) -->
        <section id="makro" class="tab-content space-y-4">
            <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5">
                <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500 mb-6 flex items-center gap-2">
                    <i data-lucide="hard-hat" class="w-4 h-4"></i> Makro Engenharia (08h-18h)
                </h3>
                <div class="space-y-4">
                    <div class="flex gap-2">
                        <input type="text" id="makro-tarefa" placeholder="Nova ordem de servi√ßo..." class="flex-1 p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                        <button onclick="addMakroTask()" class="bg-blue-600 px-5 rounded-2xl active:scale-95 transition"><i data-lucide="plus" class="w-5 h-5"></i></button>
                    </div>
                    <div id="makro-task-list" class="space-y-2"></div>
                </div>
            </div>

            <div class="bg-slate-900/40 p-6 rounded-[2.5rem] border border-white/5">
                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 mb-4 flex items-center gap-2"><i data-lucide="file-text" class="w-4 h-4"></i> Notas de Campo</p>
                <textarea id="makro-notes" oninput="saveMakroNotes()" placeholder="Escreva aqui apontamentos r√°pidos do dia de trabalho..." class="w-full h-40 bg-slate-950 border border-white/5 rounded-2xl p-4 text-xs italic text-slate-400 outline-none resize-none"></textarea>
            </div>
        </section>

        <!-- 5. FINAN√áAS -->
        <section id="financas" class="tab-content space-y-4">
            <div class="bg-slate-900 border border-white/5 p-6 rounded-[2.5rem]">
                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-emerald-500 mb-2 flex items-center gap-2"><i data-lucide="pie-chart" class="w-4 h-4"></i> Fluxo de Caixa</p>
                <p class="text-4xl font-black tracking-tighter text-white py-2"><span class="text-lg">R$</span> <span id="fin-saldo-atual">0</span></p>
            </div>

            <div class="bg-slate-900/40 p-6 rounded-[2.5rem] border border-white/5">
                <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 mb-4 flex items-center gap-2"><i data-lucide="plus-circle" class="w-4 h-4 text-emerald-500"></i> Novo Lan√ßamento</h3>
                <div class="space-y-3">
                    <select id="fin-categoria" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none appearance-none"></select>
                    <input type="text" id="fin-desc" placeholder="Descri√ß√£o..." class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                    <input type="number" id="fin-valor" placeholder="Valor Total" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                    
                    <div class="flex gap-2 mt-2">
                        <label class="pulse-check flex-1 flex items-center p-3 sm:p-4 bg-slate-950 border border-white/5 rounded-2xl cursor-pointer">
                            <input type="checkbox" class="hidden" id="fin-planejado" onchange="toggleDataVencimento()">
                            <div class="w-5 h-5 border-2 border-slate-700 rounded-lg flex items-center justify-center mr-2 transition-colors flex-shrink-0">
                                <svg class="w-3 h-3 text-white opacity-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <span class="text-[9px] font-bold uppercase tracking-[0.2em] text-slate-300 transition-colors">Agendar</span>
                        </label>
                        <input type="date" id="fin-data-vencimento" class="hidden flex-1 p-3 sm:p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-400 outline-none">
                    </div>

                    <div class="grid grid-cols-2 gap-3 pt-2">
                        <button onclick="lancarFinanca('receita')" class="bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 py-4 rounded-2xl font-black uppercase text-[10px] active:scale-95 transition-all">Entrada</button>
                        <button onclick="lancarFinanca('despesa')" class="bg-red-500/10 text-red-500 border border-red-500/20 py-4 rounded-2xl font-black uppercase text-[10px] active:scale-95 transition-all">Sa√≠da</button>
                    </div>
                </div>
            </div>

            <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5">
                <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 mb-4 flex items-center gap-2"><i data-lucide="history" class="w-4 h-4 text-slate-500"></i> Linha do Tempo</h3>
                <div class="space-y-3" id="fin-history-list"></div>
            </div>
        </section>

        <!-- 6. CONFIGURA√á√ïES -->
        <section id="config" class="tab-content space-y-4">
            <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 text-xs font-bold text-slate-400">
                <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500 mb-6 flex items-center gap-2"><i data-lucide="activity" class="w-4 h-4"></i> Biometria</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block mb-1 uppercase tracking-widest text-[8px]">Peso (KG)</label><input type="number" id="peso-user" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl outline-none text-slate-300"></div>
                    <div><label class="block mb-1 uppercase tracking-widest text-[8px]">Altura (CM)</label><input type="number" id="altura-user" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl outline-none text-slate-300"></div>
                </div>
            </div>

            <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 text-xs font-bold text-slate-400">
                <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500 mb-6 flex items-center gap-2"><i data-lucide="bike" class="w-4 h-4"></i> Setup Operacional</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block mb-1 uppercase tracking-widest text-[8px]">Estado</label><select id="estado" onchange="changeEstado()" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl outline-none"></select></div>
                    <div><label class="block mb-1 uppercase tracking-widest text-[8px]">Cidade</label><select id="cidade" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl outline-none"></select></div>
                </div>
            </div>

            <button onclick="saveConfig()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase text-[10px] shadow-xl">Guardar Settings</button>
        </section>

        <!-- UI MODAL NATIVO -->
        <div id="pulse-modal" class="fixed inset-0 z-[999] bg-black/80 hidden flex-col items-center justify-center backdrop-blur-sm p-4 transition-opacity opacity-0">
            <div id="pulse-modal-content" class="bg-slate-900 border border-white/10 p-6 rounded-[2.5rem] w-full max-w-sm shadow-2xl scale-95 transition-transform duration-300">
                <div class="flex items-center gap-3 mb-4">
                    <div id="pulse-modal-icon" class="w-8 h-8 rounded-xl bg-blue-500/10 text-blue-500 flex items-center justify-center"></div>
                    <h3 id="pulse-modal-title" class="text-lg font-black text-white uppercase tracking-tighter leading-none">Aviso</h3>
                </div>
                <p id="pulse-modal-msg" class="text-xs text-slate-400 mb-4 font-medium leading-relaxed"></p>
                <div id="pulse-modal-custom-content" class="space-y-3 mb-6">
                    <input type="text" id="pulse-modal-input" class="hidden w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                </div>
                <div class="flex gap-3 justify-end">
                    <button id="pulse-modal-cancel" class="hidden px-5 py-3.5 rounded-2xl text-[10px] font-black text-slate-400 hover:text-white uppercase tracking-widest transition">Cancelar</button>
                    <button id="pulse-modal-confirm" class="px-5 py-3.5 rounded-2xl text-[10px] font-black bg-blue-600 text-white uppercase tracking-widest shadow-lg shadow-blue-500/20 active:scale-95 transition">Confirmar</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Navega√ß√£o -->
    <nav class="fixed bottom-0 left-0 right-0 h-20 bg-slate-900/90 backdrop-blur-2xl border-t border-white/5 z-50">
        <div class="flex justify-around items-center h-full max-w-lg mx-auto">
            <button onclick="openTab('dashboard')" id="btn-dashboard" class="nav-btn flex flex-col items-center gap-1 transition-all text-blue-500"><i data-lucide="layout-dashboard" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Home</span></button>
            <button onclick="openTab('saude')" id="btn-saude" class="nav-btn flex flex-col items-center gap-1 transition-all text-slate-500"><i data-lucide="activity" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Sa√∫de</span></button>
            <button onclick="openTab('bike')" id="btn-bike" class="nav-btn flex flex-col items-center gap-1 transition-all text-slate-500"><i data-lucide="bike" class="w-5 h-5"></i><span id="nav-bike-name" class="text-[7px] font-black uppercase">Ve√≠culo</span></button>
            <button onclick="openTab('makro')" id="btn-makro" class="nav-btn flex flex-col items-center gap-1 transition-all text-slate-500"><i data-lucide="hard-hat" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Makro</span></button>
            <button onclick="openTab('financas')" id="btn-financas" class="nav-btn flex flex-col items-center gap-1 transition-all text-slate-500"><i data-lucide="wallet" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Finan√ßas</span></button>
        </div>
    </nav>

    <script>
        lucide.createIcons();

        // --- MODAL ---
        const PulseModal = {
            show({ title, msg, icon = 'bell', type = 'alert', inputVal = '', customHTML = '', confirmText = 'OK', cancelText = 'Cancelar', onConfirm }) {
                const modal = document.getElementById('pulse-modal');
                const content = document.getElementById('pulse-modal-content');
                const customContainer = document.getElementById('pulse-modal-custom-content');
                document.getElementById('pulse-modal-title').innerText = title;
                document.getElementById('pulse-modal-msg').innerHTML = msg;
                document.getElementById('pulse-modal-icon').innerHTML = `<i data-lucide="${icon}" class="w-4 h-4"></i>`;
                lucide.createIcons();
                const inputEl = document.getElementById('pulse-modal-input');
                const btnCancel = document.getElementById('pulse-modal-cancel');
                const btnConfirm = document.getElementById('pulse-modal-confirm');
                btnConfirm.innerText = confirmText; btnCancel.innerText = cancelText;
                customContainer.innerHTML = '';
                if(customHTML) { customContainer.innerHTML = customHTML; inputEl.classList.add('hidden'); }
                else if(type === 'prompt') { customContainer.appendChild(inputEl); inputEl.classList.remove('hidden'); inputEl.value = inputVal; setTimeout(() => inputEl.focus(), 300); }
                if(type === 'confirm' || type === 'prompt' || customHTML) btnCancel.classList.remove('hidden'); else btnCancel.classList.add('hidden');
                modal.classList.remove('hidden'); modal.classList.add('flex');
                setTimeout(() => { modal.classList.replace('opacity-0', 'opacity-100'); content.classList.replace('scale-95', 'scale-100'); }, 10);
                btnCancel.onclick = () => this.close();
                btnConfirm.onclick = () => {
                    let result = true;
                    if(customHTML) { result = {}; customContainer.querySelectorAll('input, select').forEach(el => result[el.id] = el.value); }
                    else if(type === 'prompt') { result = inputEl.value; }
                    this.close(); if(onConfirm) onConfirm(result);
                };
            },
            close() {
                const modal = document.getElementById('pulse-modal');
                const content = document.getElementById('pulse-modal-content');
                modal.classList.replace('opacity-100', 'opacity-0'); content.classList.replace('scale-100', 'scale-95');
                setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('flex'); }, 300);
            }
        };

        // --- DADOS ---
        let saldoAtual = parseFloat(localStorage.getItem('saldoAtual')) || 0;
        let transacoes = JSON.parse(localStorage.getItem('transacoes')) || [];
        let makroTasks = JSON.parse(localStorage.getItem('makroTasks')) || [];
        const locaisBR = { "CE": ["Fortaleza", "Caucaia"], "SP": ["S√£o Paulo", "Santos"] };
        const defaultCategorias = ["Sal√°rio", "Alimenta√ß√£o", "Ve√≠culo", "Contas", "Outros"];

        // --- FUN√á√ïES ---
        function updateFinancas() {
            document.getElementById('dash-saldo').innerText = saldoAtual.toFixed(0);
            document.getElementById('fin-saldo-atual').innerText = saldoAtual.toFixed(0);
            localStorage.setItem('saldoAtual', saldoAtual);
            renderTransacoes();
        }

        function renderTransacoes() {
            const cats = [...defaultCategorias, ...(JSON.parse(localStorage.getItem('customCategorias')) || [])];
            document.getElementById('fin-categoria').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join('');
            const html = transacoes.slice().reverse().slice(0, 15).map(t => `
                <div class="flex justify-between items-center p-4 bg-slate-950 rounded-2xl border ${t.status === 'planejada' ? 'border-dashed opacity-70 border-slate-500' : 'border-white/5'} group">
                    <div class="flex items-center gap-4">
                        <div class="w-8 h-8 rounded-xl flex items-center justify-center ${t.tipo === 'receita' ? 'bg-emerald-500/10 text-emerald-500' : 'bg-red-500/10 text-red-500'}">
                            <i data-lucide="${t.tipo === 'receita' ? 'arrow-up-right' : 'arrow-down-right'}" class="w-4 h-4"></i>
                        </div>
                        <div class="overflow-hidden"><p class="text-xs font-bold text-slate-300 truncate max-w-[120px]">${t.desc}</p><p class="text-[8px] font-black uppercase text-slate-600">${t.cat} ‚Ä¢ ${t.data}</p></div>
                    </div>
                    <div class="flex flex-col items-end gap-1"><p class="text-xs font-black ${t.tipo === 'receita' ? 'text-emerald-400' : 'text-red-400'}">${t.tipo === 'receita' ? '+' : '-'} R$ ${t.valor.toFixed(0)}</p>
                    <div class="flex gap-3">${t.status === 'planejada' ? `<button onclick="efetivarTransacao(${t.id})" class="text-emerald-500"><i data-lucide="check-circle" class="w-3.5 h-3.5"></i></button>` : ''}<button onclick="editarTransacao(${t.id})" class="text-slate-500"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button><button onclick="excluirTransacao(${t.id})" class="text-slate-500"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button></div></div>
                </div>`).join('');
            document.getElementById('fin-history-list').innerHTML = html || '<p class="text-center text-[9px] text-slate-600">Nenhum lan√ßamento.</p>';
            const bikeTx = transacoes.filter(t => t.cat === 'Ve√≠culo').reverse().slice(0, 5).map(t => `<div class="p-3 bg-slate-950 rounded-xl border border-white/5 flex justify-between items-center"><span class="text-[10px] font-bold">${t.desc}</span><span class="text-[10px] font-black text-red-400">R$ ${t.valor.toFixed(0)}</span></div>`).join('');
            document.getElementById('bike-history-list').innerHTML = bikeTx || '<p class="text-center text-[9px] text-slate-600">Nenhum servi√ßo.</p>';
            lucide.createIcons();
        }

        function editarTransacao(id) {
            const t = transacoes.find(x => x.id === id);
            const cats = [...defaultCategorias, ...(JSON.parse(localStorage.getItem('customCategorias')) || [])];
            const [d,m,y] = t.data.split('/');
            const customHTML = `
                <div class="space-y-3">
                    <input type="text" id="edit-desc" value="${t.desc}" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-xs font-bold text-slate-300">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="edit-valor" value="${t.valor}" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-xs font-bold text-slate-300">
                        <input type="date" id="edit-data" value="${y}-${m}-${d}" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-xs font-bold text-slate-400">
                    </div>
                    <select id="edit-cat" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-xs font-bold text-slate-300">
                        ${cats.map(c => `<option value="${c}" ${c === t.cat ? 'selected' : ''}>${c}</option>`).join('')}
                    </select>
                    <select id="edit-tipo" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-xs font-bold text-slate-300">
                        <option value="receita" ${t.tipo === 'receita' ? 'selected' : ''}>Entrada</option>
                        <option value="despesa" ${t.tipo === 'despesa' ? 'selected' : ''}>Sa√≠da</option>
                    </select>
                </div>`;
            PulseModal.show({ title: 'Editar', msg: 'Ajuste os dados:', icon: 'edit-2', customHTML, onConfirm: (data) => {
                if(t.status !== 'planejada') saldoAtual += (t.tipo === 'receita' ? -t.valor : t.valor);
                t.desc = data['edit-desc']; t.valor = parseFloat(data['edit-valor']); t.cat = data['edit-cat']; t.tipo = data['edit-tipo']; t.data = data['edit-data'].split('-').reverse().join('/');
                if(t.status !== 'planejada') saldoAtual += (t.tipo === 'receita' ? t.valor : -t.valor);
                localStorage.setItem('transacoes', JSON.stringify(transacoes)); updateFinancas();
            }});
        }

        function excluirTransacao(id) {
            PulseModal.show({ title: 'Excluir', msg: 'Deseja apagar este registro?', icon: 'trash-2', type: 'confirm', onConfirm: () => {
                const idx = transacoes.findIndex(x => x.id === id); const t = transacoes[idx];
                if(t.status !== 'planejada') saldoAtual += (t.tipo === 'receita' ? -t.valor : t.valor);
                transacoes.splice(idx, 1); localStorage.setItem('transacoes', JSON.stringify(transacoes)); updateFinancas();
            }});
        }

        function lancarFinanca(tipo) {
            const desc = document.getElementById('fin-desc').value || 'Manual';
            const val = parseFloat(document.getElementById('fin-valor').value);
            const isP = document.getElementById('fin-planejado').checked;
            const dataV = document.getElementById('fin-data-vencimento').value;
            if(!val) return;
            const dataFinal = isP ? dataV.split('-').reverse().join('/') : new Date().toLocaleDateString('pt-BR');
            transacoes.push({ id: Date.now(), tipo, cat: document.getElementById('fin-categoria').value, desc, valor: val, data: dataFinal, status: isP ? 'planejada' : 'efetivada' });
            if(!isP) saldoAtual += (tipo === 'receita' ? val : -val);
            localStorage.setItem('transacoes', JSON.stringify(transacoes)); updateFinancas();
            document.getElementById('fin-desc').value = ''; document.getElementById('fin-valor').value = '';
        }

        // --- L√ìGICA MAKRO ---
        function renderMakroTasks() {
            document.getElementById('makro-task-list').innerHTML = makroTasks.map((t, i) => `
                <div class="flex items-center justify-between p-4 bg-slate-950 border border-white/5 rounded-2xl">
                    <div class="flex items-center gap-3" onclick="toggleMakroTask(${i})">
                        <div class="w-5 h-5 border-2 rounded ${t.done ? 'bg-blue-600 border-blue-600' : 'border-slate-700'} flex items-center justify-center">${t.done ? '<i data-lucide="check" class="w-3 h-3"></i>' : ''}</div>
                        <span class="text-xs font-bold uppercase ${t.done ? 'line-through text-slate-600' : ''}">${t.text}</span>
                    </div>
                    <button onclick="deleteMakroTask(${i})" class="text-slate-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>`).join('');
            lucide.createIcons();
            localStorage.setItem('makroTasks', JSON.stringify(makroTasks));
        }
        function addMakroTask() { const inp = document.getElementById('makro-tarefa'); if(inp.value) { makroTasks.push({ text: inp.value, done: false }); inp.value = ''; renderMakroTasks(); } }
        function toggleMakroTask(i) { makroTasks[i].done = !makroTasks[i].done; renderMakroTasks(); }
        function deleteMakroTask(i) { makroTasks.splice(i, 1); renderMakroTasks(); }
        function saveMakroNotes() { localStorage.setItem('makroNotes', document.getElementById('makro-notes').value); }

        // --- L√ìGICA VE√çCULO ---
        function lancarServico() {
            const t = document.getElementById('servico-tipo').value; const k = parseInt(document.getElementById('servico-km').value); const v = parseFloat(document.getElementById('servico-valor').value);
            if(!k || !v) return;
            localStorage.setItem('kmAtual', k); if(t === 'Troca de √ìleo') localStorage.setItem('kmOleo', k);
            saldoAtual -= v; registrarTransacao('despesa', 'Ve√≠culo', t, v); updateFinancas(); atualizarDashboard();
        }
        function atualizarDashboard() {
            document.getElementById('dash-saldo').innerText = saldoAtual.toFixed(0);
            const kmA = parseInt(localStorage.getItem('kmAtual')) || 0; const kmO = parseInt(localStorage.getItem('kmOleo')) || 0;
            const dif = Math.max(0, kmA - kmO); const rst = Math.max(0, 5000 - dif);
            document.getElementById('dash-km-atual').innerText = kmA;
            document.getElementById('dash-oil-text').innerText = `√ìLEO EM ${rst} KM`;
            document.getElementById('dash-oil-bar').style.width = `${Math.min((dif/5000)*100, 100)}%`;
        }

        function registrarTransacao(tipo, cat, desc, valor) {
            transacoes.push({ id: Date.now(), tipo, cat, desc, valor, data: new Date().toLocaleDateString('pt-BR'), status: 'efetivada' });
            localStorage.setItem('transacoes', JSON.stringify(transacoes));
        }

        function openTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('text-blue-500', 'text-slate-500'));
            const btn = document.getElementById('btn-' + (id === 'config' ? 'dashboard' : id));
            if(btn) btn.classList.replace('text-slate-500', 'text-blue-500');
            if(id === 'dashboard') atualizarDashboard();
        }

        function carregarConfig() {
            document.getElementById('peso-user').value = localStorage.getItem('pesoUser') || 80;
            const uf = localStorage.getItem('estado') || 'CE';
            document.getElementById('estado').innerHTML = Object.keys(locaisBR).map(k => `<option value="${k}" ${k === uf ? 'selected' : ''}>${k}</option>`).join('');
            changeEstado(); document.getElementById('cidade').value = localStorage.getItem('cidade') || 'Fortaleza';
            document.getElementById('current-location').innerText = `${document.getElementById('cidade').value.toUpperCase()} ‚Ä¢ ACTIVO`;
            document.getElementById('makro-notes').value = localStorage.getItem('makroNotes') || '';
            updateFinancas(); atualizarDashboard(); renderMakroTasks();
        }
        function changeEstado() { const uf = document.getElementById('estado').value; document.getElementById('cidade').innerHTML = locaisBR[uf].map(c => `<option value="${c}">${c}</option>`).join(''); }
        function saveConfig() {
            localStorage.setItem('pesoUser', document.getElementById('peso-user').value);
            localStorage.setItem('estado', document.getElementById('estado').value);
            localStorage.setItem('cidade', document.getElementById('cidade').value);
            carregarConfig(); openTab('dashboard');
        }

        window.onload = carregarConfig;
        function addMonster() { const m = (parseInt(localStorage.getItem('monster')) || 0) + 1; localStorage.setItem('monster', m); document.getElementById('monster-count').innerText = m; document.getElementById('caf-bar').style.width = Math.min(m*20, 100)+'%'; }
        function toggleDataVencimento() { document.getElementById('fin-data-vencimento').classList.toggle('hidden', !document.getElementById('fin-planejado').checked); }
        function addWaterWork() {} function addWaterHome() {} function resetWater() {} function toggleServicoFields() {} function calcCombustivel() {} function changeTipo() {} function changeMontadora() {} function changeModelo() {} function atualizarNomeVeiculo() {}
    </script>
</body>
</html>
