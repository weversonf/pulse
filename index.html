<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse v01.17</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-main: #121418;
            --bg-card: #1E2128;
            --accent-blue: #38bdf8;
            --text-muted: #8c92a0;
        }
        body {
            background-color: #000;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .app-container {
            background-color: var(--bg-main);
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }
        .card {
            background-color: var(--bg-card);
        }
        ::-webkit-scrollbar {
            display: none;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex justify-center h-screen w-full overflow-hidden text-white">

    <div class="app-container w-full max-w-md h-full relative flex flex-col">
        
        <!-- Header Fixo -->
        <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0">
            <div>
                <h1 id="header-title" class="text-2xl font-bold tracking-tight transition-all">Visão Geral</h1>
                <p class="text-sm text-gray-400 mt-1">Fortaleza, CE</p>
            </div>
            <button class="relative w-10 h-10 flex items-center justify-center rounded-full bg-[#1E2128] border border-gray-700 cursor-pointer hover:bg-gray-800 transition-colors shrink-0">
                <i data-lucide="bell" class="w-5 h-5 text-gray-300"></i>
                <span class="absolute top-[8px] right-[8px] w-2.5 h-2.5 bg-red-500 border-2 border-[#1E2128] rounded-full"></span>
            </button>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto px-6 pb-28">
            
            <!-- PÁGINA 1: HOME -->
            <div id="page-home" class="page-content block space-y-5 fade-in">
                
                <div class="card rounded-3xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-[#38bdf8]/10 flex items-center justify-center text-[#38bdf8]">
                                <i data-lucide="wallet" class="w-5 h-5"></i>
                            </div>
                            <h2 class="text-gray-400 font-medium">Saldo Atual</h2>
                        </div>
                        <i data-lucide="chevron-right" class="w-5 h-5 text-gray-500"></i>
                    </div>
                    <div class="flex items-end space-x-2">
                        <span class="text-3xl font-bold sensitive-value" id="home-saldo" data-value="0">R$ 0,00</span>
                    </div>
                </div>

                <!-- Card da Moto/Carro -->
                <div class="card rounded-3xl p-6 shadow-sm cursor-pointer hover:bg-gray-800 transition-colors border border-transparent hover:border-orange-500/30" onclick="navigate(null, 'page-veiculo', 'Seu Veículo')">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center text-orange-500">
                                <i data-lucide="bike" id="home-veiculo-icon" class="w-5 h-5"></i>
                            </div>
                            <h2 id="home-veiculo-nome" class="text-gray-400 font-medium">Fazer 250</h2>
                        </div>
                        <i data-lucide="chevron-right" class="w-5 h-5 text-gray-500"></i>
                    </div>
                    <div class="mb-2 flex justify-between items-end">
                        <span class="text-2xl font-bold">1.200 km</span>
                        <span class="text-sm text-gray-400">para revisão</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-3">
                        <div class="bg-orange-500 h-2 rounded-full" style="width: 70%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Média: <span id="home-veiculo-kml">29</span> km/l. Pronto para viagem.</p>
                </div>

                <div class="card rounded-3xl p-6 shadow-sm cursor-pointer hover:bg-gray-800 transition-colors border border-transparent hover:border-blue-500/30" onclick="navigate(document.getElementById('nav-saude'), 'page-saude', 'Saúde e Bem-estar')">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500">
                                <i data-lucide="droplet" class="w-5 h-5"></i>
                            </div>
                            <h2 class="text-gray-400 font-medium">Hidratação Hoje</h2>
                        </div>
                        <button class="text-[#38bdf8] text-sm font-medium px-2 py-1 bg-[#38bdf8]/10 rounded-lg hover:bg-[#38bdf8]/20 transition-colors" onclick="event.stopPropagation();">+ 473ml</button>
                    </div>
                    <div class="mb-2 flex items-end space-x-2">
                        <span class="text-2xl font-bold">1.419 ml</span>
                        <span class="text-sm text-gray-400 pb-1">/ 3.500 ml</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-3">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: 40%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">3 copos no escritório concluídos.</p>
                </div>
            </div>

            <!-- PÁGINA 2: SAÚDE -->
            <div id="page-saude" class="page-content hidden space-y-5 fade-in">
                <div class="flex justify-between items-center mb-2 px-1">
                    <h2 class="text-lg font-bold text-gray-200">Visão de Hoje</h2>
                    <button class="flex items-center space-x-2 text-[#38bdf8] bg-[#38bdf8]/10 px-3 py-1.5 rounded-xl hover:bg-[#38bdf8]/20 transition-colors" onclick="abrirAjustesSaude()">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                        <span class="text-xs font-bold">Ajustes</span>
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="card rounded-3xl p-5 shadow-sm flex flex-col items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-blue-500/5 z-0"></div>
                        <div class="relative z-10 w-24 h-24 rounded-full border-[6px] border-gray-700 flex flex-col items-center justify-center mb-3">
                            <span class="text-xl font-bold text-white">40%</span>
                        </div>
                        <h3 class="text-sm font-bold z-10 text-blue-400">3.5 L / Dia</h3>
                        <p class="text-gray-400 text-[10px] z-10 text-center mt-1 leading-tight">Faltam 3 no escritório, 1 em casa.</p>
                    </div>

                    <div class="card rounded-3xl p-5 shadow-sm flex flex-col items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-yellow-500/5 z-0"></div>
                        <div class="relative z-10 w-24 h-24 rounded-full border-[6px] border-yellow-500 border-l-gray-700 flex flex-col items-center justify-center mb-3">
                            <span class="text-xl font-bold text-white">150<span class="text-xs text-gray-400">mg</span></span>
                        </div>
                        <h3 class="text-sm font-bold z-10 text-yellow-500">Máx: 400mg</h3>
                        <p class="text-gray-400 text-[10px] z-10 text-center mt-1 leading-tight">Dentro do limite diário seguro.</p>
                    </div>
                </div>

                <div>
                    <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 px-1">Lançamento Rápido</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="card rounded-2xl p-4 flex items-center space-x-3 hover:bg-gray-800 transition-colors border border-gray-800">
                            <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500 shrink-0"><i data-lucide="droplet" class="w-5 h-5"></i></div>
                            <div class="text-left"><span class="block text-sm font-medium">Escritório</span><span class="block text-xs text-blue-400">+ 473 ml</span></div>
                        </button>
                        <button class="card rounded-2xl p-4 flex items-center space-x-3 hover:bg-gray-800 transition-colors border border-gray-800">
                            <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500 shrink-0"><i data-lucide="glass-water" class="w-5 h-5"></i></div>
                            <div class="text-left"><span class="block text-sm font-medium">Casa</span><span class="block text-xs text-blue-400">+ 250 ml</span></div>
                        </button>
                        <button class="card rounded-2xl p-4 flex items-center space-x-3 hover:bg-gray-800 transition-colors border border-gray-800">
                            <div class="w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center text-orange-500 shrink-0"><i data-lucide="coffee" class="w-5 h-5"></i></div>
                            <div class="text-left"><span class="block text-sm font-medium">Café</span><span class="block text-xs text-orange-400">+ 80 mg</span></div>
                        </button>
                        <button class="card rounded-2xl p-4 flex items-center space-x-3 hover:bg-gray-800 transition-colors border border-gray-800">
                            <div class="w-10 h-10 rounded-full bg-yellow-500/10 flex items-center justify-center text-yellow-500 shrink-0"><i data-lucide="zap" class="w-5 h-5"></i></div>
                            <div class="text-left"><span class="block text-sm font-medium">Energético</span><span class="block text-xs text-yellow-500">+ 150 mg</span></div>
                        </button>
                    </div>
                </div>

                <div class="card rounded-3xl p-6 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-gray-400 font-medium flex items-center space-x-2"><i data-lucide="calendar-days" class="w-4 h-4"></i><span>Relatório Mensal</span></h2>
                        <div class="flex items-center space-x-2">
                            <button class="p-1 hover:bg-gray-700 rounded-full transition-colors text-gray-500 hover:text-white"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                            <span class="text-xs text-[#38bdf8] font-bold w-14 text-center">Fev 2026</span>
                            <button class="p-1 hover:bg-gray-700 rounded-full transition-colors text-gray-500 hover:text-white"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                    <div class="flex space-x-4 mb-4 text-[10px] text-gray-400">
                        <div class="flex items-center space-x-1"><div class="w-3 h-3 rounded-full border border-blue-500"></div><span>Meta Água</span></div>
                        <div class="flex items-center space-x-1"><div class="w-2 h-2 rounded-full bg-yellow-500"></div><span>Cafeína Consumida</span></div>
                    </div>
                    <div class="grid grid-cols-7 gap-y-3 gap-x-1 text-center">
                        <div class="text-[10px] text-gray-500 font-bold">D</div><div class="text-[10px] text-gray-500 font-bold">S</div><div class="text-[10px] text-gray-500 font-bold">T</div><div class="text-[10px] text-gray-500 font-bold">Q</div><div class="text-[10px] text-gray-500 font-bold">Q</div><div class="text-[10px] text-gray-500 font-bold">S</div><div class="text-[10px] text-gray-500 font-bold">S</div>
                        <div class="flex justify-center"><div class="w-8 h-8 rounded-full border border-blue-500 flex items-center justify-center text-xs relative cursor-pointer hover:bg-blue-500/20 transition-colors" onclick="alert('Detalhes 15 Fev')">15</div></div>
                        <div class="flex justify-center"><div class="w-8 h-8 rounded-full border border-blue-500 flex items-center justify-center text-xs relative cursor-pointer hover:bg-blue-500/20 transition-colors" onclick="alert('Detalhes 16 Fev')">16<span class="absolute bottom-0 right-0 w-2 h-2 bg-yellow-500 rounded-full border border-[#1E2128]"></span></div></div>
                        <div class="flex justify-center"><div class="w-8 h-8 rounded-full border border-gray-700 flex items-center justify-center text-xs relative text-gray-400 cursor-pointer hover:bg-gray-800 transition-colors" onclick="alert('Detalhes 17 Fev')">17<span class="absolute bottom-0 right-0 w-2 h-2 bg-yellow-500 rounded-full border border-[#1E2128]"></span></div></div>
                        <div class="flex justify-center"><div class="w-8 h-8 rounded-full border border-blue-500 flex items-center justify-center text-xs relative cursor-pointer hover:bg-blue-500/20 transition-colors" onclick="alert('Detalhes 18 Fev')">18</div></div>
                        <div class="flex justify-center"><div class="w-8 h-8 rounded-full border border-blue-500 flex items-center justify-center text-xs relative cursor-pointer hover:bg-blue-500/20 transition-colors" onclick="alert('Detalhes 19 Fev')">19<span class="absolute bottom-0 right-0 w-2 h-2 bg-yellow-500 rounded-full border border-[#1E2128]"></span></div></div>
                        <div class="flex justify-center"><div class="w-8 h-8 rounded-full bg-[#38bdf8] text-[#121418] font-bold flex items-center justify-center text-xs relative shadow-[0_0_10px_rgba(56,189,248,0.4)] cursor-pointer" onclick="alert('Detalhes Hoje')">20<span class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-yellow-400 rounded-full border-2 border-[#38bdf8]"></span></div></div>
                        <div class="flex justify-center"><div class="w-8 h-8 rounded-full flex items-center justify-center text-xs text-gray-600">21</div></div>
                    </div>
                </div>
            </div>

            <!-- PÁGINA 3: FINANÇAS -->
            <div id="page-financas" class="page-content hidden space-y-5 fade-in">
                <!-- Resumo -->
                <div class="card rounded-3xl p-6 shadow-sm relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-32 h-32 bg-green-500/10 rounded-bl-full z-0"></div>
                    <div class="absolute top-4 right-4 z-20 cursor-pointer p-1" onclick="toggleVisibility()">
                        <div id="icon-eye"><i data-lucide="eye" class="w-5 h-5 text-gray-400 hover:text-white transition-colors"></i></div>
                        <div id="icon-eye-off" class="hidden"><i data-lucide="eye-off" class="w-5 h-5 text-gray-400 hover:text-white transition-colors"></i></div>
                    </div>
                    <div class="relative z-10">
                        <span class="text-gray-400 text-sm">Disponível</span>
                        <h2 id="resumo-disponivel" class="text-4xl font-bold mt-1 mb-4 sensitive-value" data-value="0">R$ 0,00</h2>
                        <div class="flex justify-between items-center mt-6">
                            <div><span class="text-xs text-gray-500 block mb-1">Gasto (Efetivado)</span><span id="resumo-gasto" class="text-sm font-semibold text-red-400 sensitive-value" data-value="0">R$ 0,00</span></div>
                            <div class="w-px h-8 bg-gray-700"></div>
                            <div class="text-right"><span class="text-xs text-gray-500 block mb-1">Receita (Efetivada)</span><span id="resumo-receita" class="text-sm font-semibold text-green-400 sensitive-value" data-value="0">R$ 0,00</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-3">
                    <button class="card rounded-2xl py-4 flex flex-col items-center justify-center hover:bg-gray-800 transition-colors" onclick="abrirTransacaoFinancas('despesa')"><i data-lucide="arrow-up-right" class="w-6 h-6 text-red-400 mb-2"></i><span class="text-xs font-medium">Despesa</span></button>
                    <button class="card rounded-2xl py-4 flex flex-col items-center justify-center hover:bg-gray-800 transition-colors" onclick="abrirTransacaoFinancas('receita')"><i data-lucide="arrow-down-left" class="w-6 h-6 text-green-400 mb-2"></i><span class="text-xs font-medium">Receita</span></button>
                    <button class="card rounded-2xl py-4 flex flex-col items-center justify-center hover:bg-gray-800 transition-colors" onclick="abrirRelatorioFinancas()"><i data-lucide="bar-chart-2" class="w-6 h-6 text-[#38bdf8] mb-2"></i><span class="text-xs font-medium">Relatório</span></button>
                </div>
                
                <!-- Carrossel de Cartões de Crédito -->
                <div class="flex overflow-x-auto snap-x snap-mandatory gap-4 pb-2 -mx-6 px-6 relative mt-6">
                    <!-- Cartão 1 -->
                    <div class="snap-center shrink-0 w-[85%] card rounded-3xl p-6 shadow-sm relative overflow-hidden bg-gradient-to-br from-[#1E2128] to-[#121418] border border-gray-700">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center space-x-2"><i data-lucide="credit-card" class="w-5 h-5 text-gray-400"></i><span class="text-sm font-medium text-gray-300">Cartão Principal</span></div>
                            <span class="text-sm font-bold italic text-gray-400">MASTERCARD</span>
                        </div>
                        <div class="mb-4">
                            <span class="text-xs text-gray-400 block mb-1">Fatura Atual</span>
                            <span class="text-3xl font-bold sensitive-value text-white" data-value="0">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between items-end mt-6">
                            <div>
                                <span class="text-xs text-gray-500 block mb-1">Limite Disponível</span>
                                <span class="text-sm font-semibold text-green-400 sensitive-value" data-value="0">R$ 0,00</span>
                            </div>
                            <span class="text-xs text-gray-500 font-mono tracking-widest">•••• 4321</span>
                        </div>
                    </div>

                    <!-- Cartão 2 -->
                    <div class="snap-center shrink-0 w-[85%] card rounded-3xl p-6 shadow-sm relative overflow-hidden bg-gradient-to-br from-purple-900/40 to-[#121418] border border-purple-500/30">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center space-x-2"><i data-lucide="credit-card" class="w-5 h-5 text-purple-400"></i><span class="text-sm font-medium text-purple-300">Nubank</span></div>
                            <span class="text-sm font-bold italic text-purple-400/50">MASTERCARD</span>
                        </div>
                        <div class="mb-4">
                            <span class="text-xs text-purple-300/70 block mb-1">Fatura Atual</span>
                            <span class="text-3xl font-bold sensitive-value text-white" data-value="0">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between items-end mt-6">
                            <div>
                                <span class="text-xs text-purple-300/70 block mb-1">Limite Disponível</span>
                                <span class="text-sm font-semibold text-green-400 sensitive-value" data-value="0">R$ 0,00</span>
                            </div>
                            <span class="text-xs text-gray-500 font-mono tracking-widest">•••• 1928</span>
                        </div>
                    </div>
                    
                    <!-- Adicionar Cartão -->
                    <div class="snap-center shrink-0 w-[30%] card rounded-3xl p-6 shadow-sm flex flex-col items-center justify-center border border-dashed border-gray-700 cursor-pointer hover:bg-gray-800 transition-colors" onclick="abrirGerenciar()">
                        <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 mb-2">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>

                <div class="card rounded-3xl p-6 shadow-sm mt-6">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-gray-400 font-medium">Transações Recentes</h2><span class="text-xs text-[#38bdf8] font-bold cursor-pointer hover:underline" onclick="abrirExtrato()">Ver tudo</span></div>
                    
                    <div id="lista-transacoes-financas" class="space-y-4">
                        <div class="flex justify-between items-center group">
                            <div class="flex items-center space-x-3 overflow-hidden">
                                <div class="w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center text-purple-500 shrink-0">
                                    <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                                </div>
                                <div class="truncate">
                                    <span class="block text-sm font-medium truncate">Supermercado</span>
                                    <span class="block text-[10px] text-gray-500 uppercase tracking-wider truncate">Compras da semana <span class="text-blue-500 font-bold">• Efetivada</span></span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end shrink-0 ml-2">
                                <span class="text-sm font-semibold text-red-400">- R$ 240,00</span>
                                <div class="flex space-x-3 mt-1.5 opacity-80">
                                    <button class="text-gray-500 hover:text-white transition-colors" onclick="alert('Editar Transação')"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button>
                                    <button class="text-gray-500 hover:text-red-400 transition-colors" onclick="this.closest('.flex.justify-between').remove();"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center group">
                            <div class="flex items-center space-x-3 overflow-hidden">
                                <div class="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-500 shrink-0">
                                    <i data-lucide="briefcase" class="w-5 h-5"></i>
                                </div>
                                <div class="truncate">
                                    <span class="block text-sm font-medium truncate">Makro Engenharia</span>
                                    <span class="block text-[10px] text-gray-500 uppercase tracking-wider truncate">Salário <span class="text-blue-500 font-bold">• Efetivada</span></span>
                                </div>
                            </div>
                            <div class="flex flex-col items-end shrink-0 ml-2">
                                <span class="text-sm font-semibold text-green-400">+ R$ 5.400,00</span>
                                <div class="flex space-x-3 mt-1.5 opacity-80">
                                    <button class="text-gray-500 hover:text-white transition-colors" onclick="alert('Editar Transação')"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button>
                                    <button class="text-gray-500 hover:text-red-400 transition-colors" onclick="this.closest('.flex.justify-between').remove();"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PÁGINA 4: VEÍCULO -->
            <div id="page-veiculo" class="page-content hidden space-y-5 fade-in">
                
                <div class="flex justify-between items-center mb-2 px-1">
                    <h2 class="text-lg font-bold text-gray-200">Painel de Controle</h2>
                    <button class="flex items-center space-x-2 text-orange-500 bg-orange-500/10 px-3 py-1.5 rounded-xl hover:bg-orange-500/20 transition-colors" onclick="abrirAjustesVeiculo()">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                        <span class="text-xs font-bold">Ajustes</span>
                    </button>
                </div>

                <!-- Hero: Resumo do Veículo -->
                <div class="card rounded-3xl p-6 shadow-sm relative overflow-hidden bg-gradient-to-br from-[#1E2128] to-[#121418] border border-orange-500/20">
                    <div class="absolute -right-6 -top-6 w-32 h-32 bg-orange-500/10 rounded-full blur-2xl z-0"></div>
                    
                    <div class="flex justify-between items-start mb-4 relative z-10">
                        <div>
                            <h2 id="veiculo-hero-nome" class="text-2xl font-bold text-white mb-1">Fazer 250</h2>
                            <span id="veiculo-hero-montadora" class="text-xs font-medium bg-gray-800 text-gray-300 px-2 py-1 rounded-lg border border-gray-700">Yamaha</span>
                        </div>
                        <div class="w-12 h-12 rounded-full bg-orange-500/20 flex items-center justify-center text-orange-500 border border-orange-500/30">
                            <!-- Ícones pré-renderizados para toggle rápido -->
                            <i data-lucide="bike" id="icon-veiculo-moto" class="w-6 h-6 block"></i>
                            <i data-lucide="car" id="icon-veiculo-carro" class="w-6 h-6 hidden"></i>
                        </div>
                    </div>
                    
                    <div class="flex items-end justify-between mt-8 relative z-10">
                        <div>
                            <span class="text-xs text-gray-500 block mb-1">Odômetro Atual</span>
                            <span class="text-2xl font-bold text-white"><span id="veiculo-hero-odometro">18.450</span> <span class="text-sm text-gray-400 font-normal">km</span></span>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500 block mb-1">Média Constante</span>
                            <span class="text-xl font-bold text-green-400"><span id="veiculo-hero-kml">29.0</span> <span class="text-sm text-gray-400 font-normal">km/l</span></span>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação Rápida -->
                <div class="grid grid-cols-2 gap-3">
                    <button class="card rounded-2xl py-4 px-4 flex items-center justify-center space-x-3 hover:bg-gray-800 transition-colors border border-transparent hover:border-orange-500/30" onclick="abrirModalAbastecimento()">
                        <div class="w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center text-orange-500 shrink-0">
                            <i data-lucide="fuel" class="w-5 h-5"></i>
                        </div>
                        <span class="text-sm font-bold">Abastecer</span>
                    </button>
                    <button class="card rounded-2xl py-4 px-4 flex items-center justify-center space-x-3 hover:bg-gray-800 transition-colors border border-transparent hover:border-gray-500/30" onclick="abrirModalServico()">
                        <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-gray-300 shrink-0">
                            <i data-lucide="wrench" class="w-5 h-5"></i>
                        </div>
                        <span class="text-sm font-bold">Serviço</span>
                    </button>
                </div>

                <div class="card rounded-3xl p-6 shadow-sm">
                    <div class="flex justify-between items-center mb-5">
                        <h3 class="text-sm font-bold text-gray-300 flex items-center space-x-2">
                            <i data-lucide="activity" class="w-4 h-4 text-[#38bdf8]"></i>
                            <span>Status</span>
                        </h3>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <span class="text-sm font-medium">Óleo do Motor</span>
                                <span class="text-xs text-orange-400 font-bold">Trocar em 1.200 km</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div class="bg-orange-500 h-2 rounded-full" style="width: 70%"></div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center text-gray-400"><i data-lucide="circle-dashed" class="w-4 h-4"></i></div>
                                <span class="text-sm font-medium text-gray-400">Pneus (Calibragem)</span>
                            </div>
                            <span class="text-xs font-bold text-green-400">Verificado há 3 dias</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 px-1 mt-2">Últimos Lançamentos</h2>
                    <div class="space-y-3" id="lista-transacoes-veiculo">
                        <div class="card p-4 rounded-2xl flex justify-between items-center border border-gray-800">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400">
                                    <span class="text-xs font-bold">18 Fev</span>
                                </div>
                                <div>
                                    <span class="block text-sm font-bold">Posto Ipiranga</span>
                                    <span class="block text-xs text-gray-500">9,31 L • Carteira</span>
                                </div>
                            </div>
                            <span class="text-sm font-bold text-white">R$ 55,00</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Menu Fixo Inferior -->
		<nav class="fixed bottom-0 left-0 w-full h-20 card rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.3)] flex justify-around items-center px-2 z-50">
            <button id="nav-home" class="nav-btn flex flex-col items-center justify-center w-16 h-full relative text-[#38bdf8]" onclick="navigate(this, 'page-home', 'Visão Geral')">
                <div class="absolute top-0 w-6 h-0.5 bg-[#38bdf8] rounded-b-md transition-all"></div>
                <i data-lucide="home" class="w-6 h-6 mb-1"></i>
                <span class="text-[10px] font-medium">Home</span>
            </button>

            <button id="nav-saude" class="nav-btn flex flex-col items-center justify-center w-16 h-full relative text-[#8c92a0] hover:text-gray-300 transition-colors" onclick="navigate(this, 'page-saude', 'Saúde e Bem-estar')">
                <div class="absolute top-0 w-0 h-0.5 bg-[#38bdf8] rounded-b-md transition-all"></div>
                <i data-lucide="heart-pulse" class="w-6 h-6 mb-1"></i>
                <span class="text-[10px] font-medium">Saúde</span>
            </button>

            <!-- Botão Central + (FAB Menu) -->
            <div class="relative w-16 h-full flex justify-center z-50">
                <div id="fab-overlay" class="fixed inset-0 bg-black/40 z-[-1] hidden opacity-0 transition-opacity duration-300" onclick="toggleFab()"></div>

                <!-- Sub-botão: Finanças -->
                <button id="fab-financas" class="absolute -top-6 w-12 h-12 bg-[#1E2128] rounded-full flex items-center justify-center text-green-400 border border-gray-700 shadow-lg transition-all duration-300 opacity-0 scale-50 z-0 pointer-events-none" style="transform: translate(0, 0);" onclick="abrirTransacaoFinancas('despesa')">
                    <i data-lucide="dollar-sign" class="w-5 h-5"></i>
                </button>

                <!-- Sub-botão: Veículo -->
                <button id="fab-veiculo" class="absolute -top-6 w-12 h-12 bg-[#1E2128] rounded-full flex items-center justify-center text-orange-400 border border-gray-700 shadow-lg transition-all duration-300 opacity-0 scale-50 z-0 pointer-events-none" style="transform: translate(0, 0);" onclick="abrirModalAbastecimento()">
                    <i data-lucide="bike" id="fab-veiculo-icon" class="w-5 h-5"></i>
                </button>

                <!-- Botão Principal -->
                <button class="absolute -top-6 w-14 h-14 bg-[#38bdf8] rounded-full flex items-center justify-center text-white border-[6px] border-[#121418] shadow-lg hover:scale-105 transition-transform z-10" onclick="toggleFab()">
                    <i data-lucide="plus" id="fab-icon" class="w-7 h-7 transition-transform duration-300"></i>
                </button>
            </div>

            <button id="nav-financas" class="nav-btn flex flex-col items-center justify-center w-16 h-full relative text-[#8c92a0] hover:text-gray-300 transition-colors" onclick="navigate(this, 'page-financas', 'Finanças Pessoais')">
                <div class="absolute top-0 w-0 h-0.5 bg-[#38bdf8] rounded-b-md transition-all"></div>
                <i data-lucide="circle-dollar-sign" class="w-6 h-6 mb-1"></i>
                <span class="text-[10px] font-medium">Finanças</span>
            </button>

            <button id="nav-menu" class="nav-btn flex flex-col items-center justify-center w-16 h-full relative text-[#8c92a0] hover:text-gray-300 transition-colors" onclick="toggleBottomSheet()">
                <div class="absolute top-0 w-0 h-0.5 bg-[#38bdf8] rounded-b-md transition-all"></div>
                <i data-lucide="menu" class="w-6 h-6 mb-1"></i>
                <span class="text-[10px] font-medium">Menu</span>
            </button>
        </nav>

        <!-- Menu Hambúrguer (Bottom Sheet) -->
        <div id="menu-overlay" class="absolute inset-0 bg-black/60 z-[60] hidden opacity-0 transition-opacity duration-300" onclick="closeAllBottomSheets()"></div>
        <div id="bottom-sheet" class="absolute bottom-0 w-full bg-[#1E2128] rounded-t-3xl z-[70] transform translate-y-full transition-transform duration-300 shadow-[0_-15px_40px_rgba(0,0,0,0.7)] flex flex-col">
            <div class="w-full flex justify-center pt-4 pb-2" onclick="closeAllBottomSheets()">
                <div class="w-12 h-1.5 bg-gray-600 rounded-full cursor-pointer"></div>
            </div>
            <div class="px-6 pb-10 pt-4 space-y-3">
                <button class="w-full flex items-center space-x-4 p-4 rounded-2xl bg-[#121418]/50 hover:bg-gray-800 transition-colors border border-transparent hover:border-orange-500/30" onclick="navigate(null, 'page-veiculo', 'Seu Veículo'); closeAllBottomSheets();">
                    <div class="w-12 h-12 rounded-full bg-orange-500/10 flex items-center justify-center text-orange-500">
                        <i data-lucide="bike" id="menu-veiculo-icon" class="w-6 h-6"></i>
                    </div>
                    <div class="flex flex-col items-start">
                        <span class="text-white font-medium text-lg">Veículo</span>
                        <span class="text-xs text-gray-500" id="menu-veiculo-nome">Sua Fazer 250</span>
                    </div>
                </button>
                <button class="w-full flex items-center space-x-4 p-4 rounded-2xl bg-[#121418]/50 hover:bg-gray-800 transition-colors border border-transparent hover:border-[#38bdf8]/30" onclick="abrirGerenciar()">
                    <div class="w-12 h-12 rounded-full bg-[#38bdf8]/10 flex items-center justify-center text-[#38bdf8]">
                        <i data-lucide="layers" class="w-6 h-6"></i>
                    </div>
                    <div class="flex flex-col items-start">
                        <span class="text-white font-medium text-lg">Contas e Categorias</span>
						<button id="btn-zerar"
        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-xl mt-4 w-full">
    Zerar Tudo
</button>
                        <span class="text-xs text-gray-500">Gerir bancos e classificações</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- ================= MODAIS COMPLEMENTARES ================= -->
        
        <!-- Modal: Ajustes do Veículo -->
        <div id="modal-ajustes-veiculo" class="absolute inset-0 bg-[#121418] z-[90] transform translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0 border-b border-gray-800 bg-[#1E2128]">
                <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors" onclick="fecharAjustesVeiculo()"><i data-lucide="arrow-left" class="w-5 h-5 text-gray-300"></i></button>
                <h1 class="text-lg font-bold text-orange-500">Ajustes do Veículo</h1><div class="w-10 h-10"></div>
            </header>
            <main class="flex-1 overflow-y-auto p-6 space-y-6">
                <div class="bg-gray-800 p-1 rounded-xl flex items-center w-full">
                    <button id="btn-tipo-moto" class="flex-1 py-2 text-sm font-bold rounded-lg bg-orange-500 text-[#121418] shadow-sm transition-all" onclick="selecionarTipoVeiculo('moto')">Moto</button>
                    <button id="btn-tipo-carro" class="flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:text-white transition-all" onclick="selecionarTipoVeiculo('carro')">Carro</button>
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Montadora</label>
                    <div class="relative">
                        <select id="select-montadora" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-gray-700 transition-all appearance-none cursor-pointer" onchange="atualizarModelos()"></select>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 absolute right-4 top-4 pointer-events-none"></i>
                    </div>
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Modelo do Veículo</label>
                    <div class="relative">
                        <select id="select-modelo" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-gray-700 transition-all appearance-none cursor-pointer" onchange="atualizarConsumo()"></select>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 absolute right-4 top-4 pointer-events-none"></i>
                    </div>
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Odômetro Atual (km)</label>
                    <input type="number" id="input-odometro" value="18450" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-gray-700 transition-all font-bold text-xl">
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Média de Consumo (pode ser editado)</label>
                    <div class="flex items-center card p-4 rounded-2xl border border-gray-700 focus-within:border-orange-500 focus-within:ring-2 focus-within:ring-orange-500 transition-all">
                        <input type="number" id="input-kml" step="0.1" value="29.0" class="bg-transparent w-full outline-none text-white font-bold text-xl">
                        <span class="text-gray-500 ml-2 font-bold">km/l</span>
                    </div>
                    <p class="text-[10px] text-gray-500 mt-2">Valor base da internet para este modelo. Ajuste conforme sua realidade.</p>
                </div>
                <button class="w-full bg-orange-500 text-[#121418] font-bold text-lg py-4 rounded-2xl hover:bg-orange-400 transition-colors shadow-[0_0_20px_rgba(249,115,22,0.3)] mt-8" onclick="salvarAjustesVeiculo()">
                    Salvar Veículo
                </button>
            </main>
        </div>

        <!-- Modal: Abastecimento (Veículo) -->
        <div id="modal-abastecimento" class="absolute inset-0 bg-[#121418] z-[90] transform translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0 border-b border-gray-800 bg-[#1E2128]">
                <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors" onclick="fecharModalAbastecimento()"><i data-lucide="arrow-left" class="w-5 h-5 text-gray-300"></i></button>
                <h1 class="text-lg font-bold text-orange-500">Abastecimento</h1><div class="w-10 h-10"></div>
            </header>
            <main class="flex-1 overflow-y-auto p-6 space-y-6">
                <p class="text-xs text-gray-400 text-center">Digite dois valores para o sistema calcular o terceiro automaticamente.</p>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col col-span-2">
                        <label class="text-sm text-gray-400 mb-1">Preço do Litro (R$)</label>
                        <input type="number" id="abs-preco" placeholder="Ex: 5,50" step="0.01" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-transparent transition-all font-bold text-lg text-center" oninput="calcularAbastecimento('preco')">
                    </div>
                    <div class="flex flex-col">
                        <label class="text-sm text-gray-400 mb-1">Total Pago (R$)</label>
                        <input type="number" id="abs-total" placeholder="Ex: 50,00" step="0.01" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-transparent transition-all font-bold text-lg text-center" oninput="calcularAbastecimento('total')">
                    </div>
                    <div class="flex flex-col">
                        <label class="text-sm text-gray-400 mb-1">Litros (L)</label>
                        <input type="number" id="abs-litros" placeholder="Ex: 10" step="0.01" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-transparent transition-all font-bold text-lg text-center" oninput="calcularAbastecimento('litros')">
                    </div>
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Odômetro Atualizado (km)</label>
                    <input type="number" id="abs-odometro" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-transparent transition-all font-bold text-lg tracking-wider text-center">
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Descrição do Local</label>
                    <input type="text" id="abs-desc" placeholder="Ex: Posto Ipiranga" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-transparent transition-all">
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Conta de Pagamento</label>
                    <div class="relative">
                        <!-- Preenchido dinamicamente via JS (Contas e Categorias) -->
                        <select id="abs-conta" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-orange-500 border border-gray-700 transition-all appearance-none cursor-pointer"></select>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 absolute right-4 top-4 pointer-events-none"></i>
                    </div>
                </div>
                <button class="w-full bg-orange-500 text-[#121418] font-bold text-lg py-4 rounded-2xl hover:bg-orange-400 transition-colors shadow-[0_0_20px_rgba(249,115,22,0.3)] mt-6" onclick="registrarAbastecimento()">
                    Salvar e Lançar Despesa
                </button>
            </main>
        </div>

        <!-- Modal: Serviço (Veículo) -->
        <div id="modal-servico-veiculo" class="absolute inset-0 bg-[#121418] z-[90] transform translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0 border-b border-gray-800 bg-[#1E2128]">
                <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors" onclick="fecharModalServico()"><i data-lucide="arrow-left" class="w-5 h-5 text-gray-300"></i></button>
                <h1 class="text-lg font-bold text-gray-300">Novo Serviço</h1><div class="w-10 h-10"></div>
            </header>
            <main class="flex-1 overflow-y-auto p-6 space-y-6">
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Tipo de Serviço</label>
                    <div class="relative">
                        <select id="srv-tipo" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-gray-500 border border-gray-700 transition-all appearance-none cursor-pointer">
                            <option>Troca de Óleo</option><option>Lubrificação (Corrente)</option><option>Manutenção Pneus</option><option>Lavagem</option><option>Outros</option>
                        </select>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 absolute right-4 top-4 pointer-events-none"></i>
                    </div>
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Odômetro Atualizado (km)</label>
                    <input type="number" id="srv-odometro" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-gray-500 border border-transparent transition-all font-bold text-lg">
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Valor Total (R$)</label>
                    <input type="number" id="srv-total" placeholder="0,00" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-gray-500 border border-transparent transition-all font-bold text-lg">
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Conta de Pagamento</label>
                    <div class="relative">
                        <!-- Preenchido dinamicamente via JS -->
                        <select id="srv-conta" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-gray-500 border border-gray-700 transition-all appearance-none cursor-pointer"></select>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 absolute right-4 top-4 pointer-events-none"></i>
                    </div>
                </div>
                <button class="w-full bg-gray-600 text-white font-bold text-lg py-4 rounded-2xl hover:bg-gray-500 transition-colors mt-6" onclick="registrarServico()">
                    Salvar Serviço
                </button>
            </main>
        </div>

        <!-- Modal: Relatórios Finanças -->
        <div id="modal-relatorio-financas" class="absolute inset-0 bg-[#121418] z-[90] transform translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0 border-b border-gray-800 bg-[#1E2128]">
                <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors" onclick="fecharRelatorioFinancas()"><i data-lucide="arrow-left" class="w-5 h-5 text-gray-300"></i></button>
                <h1 class="text-lg font-bold">Relatórios</h1><div class="w-10 h-10"></div>
            </header>
            <main class="flex-1 overflow-y-auto flex flex-col pb-10">
                <p class="text-[10px] text-gray-400 text-center pt-6 px-6 mb-2">O gráfico de saldo projetado inclui <span class="text-blue-400 font-bold">Efetivadas</span> e <span class="text-yellow-500 font-bold">Previsíveis</span>.</p>
                <div class="px-6 flex flex-col">
                    <div class="flex justify-between items-center bg-gray-800 p-1 rounded-xl mb-4 shrink-0 overflow-x-auto snap-x">
                        <button id="btn-chart--12" class="chart-time-btn snap-center shrink-0 text-xs py-1.5 px-3 rounded-lg text-gray-400 hover:text-white transition-all" onclick="updateBarChart('-12')">-12m</button>
                        <button id="btn-chart--6" class="chart-time-btn snap-center shrink-0 text-xs py-1.5 px-3 rounded-lg text-gray-400 hover:text-white transition-all" onclick="updateBarChart('-6')">-6m</button>
                        <button id="btn-chart-atual" class="chart-time-btn snap-center shrink-0 text-xs py-1.5 px-3 rounded-lg bg-[#38bdf8] text-[#121418] font-bold transition-all" onclick="updateBarChart('atual')">Atual</button>
                        <button id="btn-chart-6" class="chart-time-btn snap-center shrink-0 text-xs py-1.5 px-3 rounded-lg text-gray-400 hover:text-white transition-all" onclick="updateBarChart('6')">+6m</button>
                        <button id="btn-chart-12" class="chart-time-btn snap-center shrink-0 text-xs py-1.5 px-3 rounded-lg text-gray-400 hover:text-white transition-all" onclick="updateBarChart('12')">+12m</button>
                    </div>
                    <div class="card p-4 rounded-3xl border border-gray-800 mb-6 shrink-0 shadow-sm">
                        <h3 class="text-sm font-bold text-gray-300 mb-4 flex items-center space-x-2"><i data-lucide="line-chart" class="w-4 h-4 text-[#38bdf8]"></i><span>Previsibilidade e Saldo</span></h3>
                        <div class="relative h-64 w-full"><canvas id="mixedChart"></canvas></div>
                    </div>
                    <div class="w-full h-px bg-gray-800 mb-6 shrink-0"></div>
                    <div class="flex justify-between items-center mb-4 shrink-0">
                        <div>
                            <h3 class="text-sm font-bold text-gray-300 flex items-center space-x-2"><i data-lucide="pie-chart" class="w-4 h-4 text-purple-400"></i><span>Por Categoria</span></h3>
                            <span class="text-[10px] text-gray-500 block mt-0.5 font-medium">Apenas Efetivadas</span>
                        </div>
                        <div class="bg-gray-800 p-1 rounded-xl flex">
                            <button id="btn-donut-despesa" class="text-xs py-1 px-3 rounded-lg bg-red-400 text-[#121418] font-bold transition-all" onclick="updateDonutChart('despesa')">Despesa</button>
                            <button id="btn-donut-receita" class="text-xs py-1 px-3 rounded-lg text-gray-400 hover:text-white transition-all" onclick="updateDonutChart('receita')">Receita</button>
                        </div>
                    </div>
                    <div class="card p-4 rounded-3xl border border-gray-800 pb-8 shrink-0 shadow-sm">
                        <div class="relative h-60 w-full flex justify-center"><canvas id="donutChart"></canvas></div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Modal: Extrato Mensal -->
        <div id="modal-extrato" class="absolute inset-0 bg-[#121418] z-[90] transform translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0 border-b border-gray-800 bg-[#1E2128]">
                <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors" onclick="fecharExtrato()"><i data-lucide="arrow-left" class="w-5 h-5 text-gray-300"></i></button>
                <h1 class="text-lg font-bold">Extrato</h1><div class="w-10 h-10"></div>
            </header>
            <main class="flex-1 overflow-y-auto flex flex-col">
                <div class="bg-[#1E2128] px-6 pb-4 rounded-b-3xl shadow-md z-10 sticky top-0">
                    <div class="flex items-center justify-between py-4">
                        <button class="p-2 hover:bg-gray-700 rounded-full transition-colors text-gray-400 hover:text-white"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                        <span class="text-sm font-bold w-32 text-center text-white uppercase tracking-wider">Fevereiro 2026</span>
                        <button class="p-2 hover:bg-gray-700 rounded-full transition-colors text-gray-400 hover:text-white"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                    </div>
                    <div class="flex space-x-2 overflow-x-auto pb-2 -mx-2 px-2 snap-x">
                        <button class="snap-center shrink-0 px-4 py-1.5 rounded-full text-xs font-bold bg-[#38bdf8] text-[#121418]">Todas</button>
                        <button class="snap-center shrink-0 px-4 py-1.5 rounded-full text-xs font-bold bg-gray-800 text-gray-400 border border-gray-700 hover:text-white transition-colors">Receitas</button>
                        <button class="snap-center shrink-0 px-4 py-1.5 rounded-full text-xs font-bold bg-gray-800 text-gray-400 border border-gray-700 hover:text-white transition-colors">Despesas</button>
                    </div>
                </div>
                <div class="p-6 space-y-6">
                    <div>
                        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">Hoje, 20 Fev</h3>
                        <div class="space-y-4 bg-[#1E2128] p-4 rounded-3xl border border-gray-800">
                            <div class="flex justify-between items-center group">
                                <div class="flex items-center space-x-3 overflow-hidden">
                                    <div class="w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center text-orange-500 shrink-0"><i data-lucide="fuel" class="w-5 h-5"></i></div>
                                    <div class="truncate">
                                        <span class="block text-sm font-medium truncate">Posto Ipiranga</span>
                                        <span class="block text-[10px] text-gray-500 uppercase tracking-wider truncate">Gasolina • Carteira <span class="text-blue-500 font-bold">• Efetivada</span></span>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end shrink-0 ml-2">
                                    <span class="text-sm font-bold text-red-400">- R$ 55,00</span>
                                    <div class="flex space-x-3 mt-1.5 opacity-80">
                                        <button class="text-gray-500 hover:text-white transition-colors" title="Editar" onclick="alert('Editar Transação')"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button>
                                        <button class="text-gray-500 hover:text-red-400 transition-colors" title="Excluir" onclick="this.closest('.flex.justify-between').remove();"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">Ontem, 19 Fev</h3>
                        <div class="space-y-4 bg-[#1E2128] p-4 rounded-3xl border border-gray-800">
                            <div class="flex justify-between items-center group">
                                <div class="flex items-center space-x-3 overflow-hidden">
                                    <div class="w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center text-purple-500 shrink-0"><i data-lucide="shopping-bag" class="w-5 h-5"></i></div>
                                    <div class="truncate">
                                        <span class="block text-sm font-medium truncate">Supermercado</span>
                                        <span class="block text-[10px] text-gray-500 uppercase tracking-wider truncate">Compras da semana • Carteira <span class="text-blue-500 font-bold">• Efetivada</span></span>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end shrink-0 ml-2">
                                    <span class="text-sm font-bold text-red-400">- R$ 240,00</span>
                                    <div class="flex space-x-3 mt-1.5 opacity-80">
                                        <button class="text-gray-500 hover:text-white transition-colors" title="Editar" onclick="alert('Editar Transação')"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button>
                                        <button class="text-gray-500 hover:text-red-400 transition-colors" title="Excluir" onclick="this.closest('.flex.justify-between').remove();"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="w-full h-px bg-gray-800"></div>
                            <div class="flex justify-between items-center group">
                                <div class="flex items-center space-x-3 overflow-hidden">
                                    <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500 shrink-0"><i data-lucide="utensils" class="w-5 h-5"></i></div>
                                    <div class="truncate">
                                        <span class="block text-sm font-medium truncate">Restaurante</span>
                                        <span class="block text-[10px] text-gray-500 uppercase tracking-wider truncate">Almoço • Nubank <span class="text-blue-500 font-bold">• Efetivada</span></span>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end shrink-0 ml-2">
                                    <span class="text-sm font-bold text-red-400">- R$ 35,00</span>
                                    <div class="flex space-x-3 mt-1.5 opacity-80">
                                        <button class="text-gray-500 hover:text-white transition-colors" title="Editar" onclick="alert('Editar Transação')"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button>
                                        <button class="text-gray-500 hover:text-red-400 transition-colors" title="Excluir" onclick="this.closest('.flex.justify-between').remove();"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">05 Fev</h3>
                        <div class="space-y-4 bg-[#1E2128] p-4 rounded-3xl border border-gray-800">
                            <div class="flex justify-between items-center group">
                                <div class="flex items-center space-x-3 overflow-hidden">
                                    <div class="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-500 shrink-0 relative"><i data-lucide="briefcase" class="w-5 h-5"></i></div>
                                    <div class="truncate">
                                        <span class="block text-sm font-medium truncate">Makro Engenharia</span>
                                        <span class="block text-[10px] text-gray-500 uppercase tracking-wider truncate">Salário Mensal • Nubank <span class="text-blue-500 font-bold">• Efetivada</span></span>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end shrink-0 ml-2">
                                    <span class="text-sm font-bold text-green-400">+ R$ 5.400,00</span>
                                    <div class="flex space-x-3 mt-1.5 opacity-80">
                                        <button class="text-gray-500 hover:text-white transition-colors" title="Editar" onclick="alert('Editar Transação')"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button>
                                        <button class="text-gray-500 hover:text-red-400 transition-colors" title="Excluir" onclick="this.closest('.flex.justify-between').remove();"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Modal: Nova Transação Finanças -->
        <div id="modal-transacao-financas" class="absolute inset-0 bg-[#121418] z-[90] transform translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0 border-b border-gray-800 bg-[#1E2128]">
                <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors" onclick="fecharTransacaoFinancas()"><i data-lucide="arrow-left" class="w-5 h-5 text-gray-300"></i></button>
                <h1 class="text-lg font-bold">Nova Transação</h1><div class="w-10 h-10"></div>
            </header>
            <main class="flex-1 overflow-y-auto p-6 space-y-6">
                <div class="bg-gray-800 p-1 rounded-xl flex items-center w-full">
                    <button id="btn-tipo-despesa" class="flex-1 py-2 text-sm font-bold rounded-lg bg-red-400 text-[#121418] shadow-sm transition-all" onclick="setTipoTransacao('despesa')">Despesa</button>
                    <button id="btn-tipo-receita" class="flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:text-white transition-all" onclick="setTipoTransacao('receita')">Receita</button>
                </div>
                <div class="flex flex-col items-center justify-center py-4">
                    <span class="text-sm text-gray-400 mb-2">Valor da Transação</span>
                    <div class="flex items-center text-4xl font-bold">
                        <span id="transacao-moeda" class="text-gray-500 mr-2">R$</span>
                        <input type="number" placeholder="0,00" class="bg-transparent w-full text-center outline-none text-white placeholder-gray-600 w-48" id="input-valor-transacao">
                    </div>
                </div>
                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Descrição</label>
                    <input type="text" id="transacao-desc" placeholder="Ex: Supermercado, Salário..." class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-[#38bdf8] border border-transparent transition-all">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col">
                        <label class="text-sm text-gray-400 mb-1">Categoria</label>
                        <div class="relative">
                            <select id="transacao-categoria" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-[#38bdf8] border border-gray-700 transition-all appearance-none cursor-pointer"></select>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 absolute right-4 top-4 pointer-events-none"></i>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <label class="text-sm text-gray-400 mb-1">Conta</label>
                        <div class="relative">
                            <select id="transacao-conta" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-[#38bdf8] border border-gray-700 transition-all appearance-none cursor-pointer"></select>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 absolute right-4 top-4 pointer-events-none"></i>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center justify-between card p-4 rounded-2xl border border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400">
                            <i data-lucide="repeat" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <span class="block text-sm font-bold text-white">Transação Fixa</span>
                            <span class="block text-xs text-gray-500">Repetir por 12 meses</span>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" value="" class="sr-only peer" id="toggle-fixa">
                        <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#38bdf8]"></div>
                    </label>
                </div>

                <div class="flex items-center justify-between card p-4 rounded-2xl border border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500">
                            <i data-lucide="check-circle" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <span class="block text-sm font-bold text-white">Status da Transação</span>
                            <span class="block text-xs text-gray-500" id="status-label">Efetivada (Paga/Recebida)</span>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" value="" class="sr-only peer" id="toggle-efetivada" checked onchange="toggleStatusTransacao(this)">
                        <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                    </label>
                </div>

                <div class="flex flex-col">
                    <label class="text-sm text-gray-400 mb-1">Data</label>
                    <input type="date" value="2026-02-25" class="card p-4 rounded-2xl w-full outline-none text-white focus:ring-2 focus:ring-[#38bdf8] border border-transparent transition-all appearance-none" style="color-scheme: dark;">
                </div>
                <button id="btn-salvar-transacao" class="w-full bg-red-400 text-[#121418] font-bold text-lg py-4 rounded-2xl hover:brightness-110 transition-colors shadow-lg mt-6" onclick="salvarTransacaoFinancas()">
                    Lançar Despesa
                </button>
            </main>
        </div>

        <!-- Modal: Gerenciar Contas e Categorias -->
        <div id="modal-gerenciar" class="absolute inset-0 bg-[#121418] z-[80] transform translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-6 pt-10 pb-4 flex justify-between items-center shrink-0 border-b border-gray-800 bg-[#1E2128]">
                <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-700 transition-colors" onclick="closeGerenciar()"><i data-lucide="arrow-left" class="w-5 h-5 text-gray-300"></i></button>
                <h1 class="text-lg font-bold">Gerenciar</h1><div class="w-10 h-10"></div>
            </header>
            <main class="flex-1 overflow-y-auto p-6 flex flex-col">
                <div class="bg-gray-800 p-1 rounded-xl flex items-center w-full mb-6">
                    <button id="tab-contas" class="flex-1 py-2 text-sm font-bold rounded-lg bg-[#38bdf8] text-[#121418] shadow-sm transition-all" onclick="switchGerenciarTab('contas')">Contas</button>
                    <button id="tab-categorias" class="flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:text-white transition-all" onclick="switchGerenciarTab('categorias')">Categorias</button>
                </div>
                
                <!-- Lista de Contas (Dinâmica) -->
                <div id="content-contas" class="block space-y-4">
                    <div id="list-contas" class="space-y-3"></div>
                    <button onclick="adicionarConta()" class="w-full mt-4 py-3 border border-dashed border-gray-600 rounded-xl text-gray-400 hover:text-white hover:border-gray-400 transition-colors flex items-center justify-center space-x-2">
                        <i data-lucide="plus" class="w-4 h-4"></i><span>Adicionar Conta</span>
                    </button>
                </div>

                <!-- Lista de Categorias (Dinâmica) -->
                <div id="content-categorias" class="hidden space-y-4">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider">Despesas</h3>
                    <div id="list-cat-despesas" class="space-y-3"></div>
                    
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mt-6">Receitas</h3>
                    <div id="list-cat-receitas" class="space-y-3"></div>
                    
                    <button onclick="adicionarCategoria()" class="w-full mt-4 py-3 border border-dashed border-gray-600 rounded-xl text-gray-400 hover:text-white hover:border-gray-400 transition-colors flex items-center justify-center space-x-2">
                        <i data-lucide="plus" class="w-4 h-4"></i><span>Nova Categoria</span>
                    </button>
                </div>
            </main>
        </div>

    </div>
	

<script type="module">
    // 1. IMPORTAÇÕES (Versão 11 - Estável)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { 
        getFirestore, collection, doc, addDoc, getDocs, 
        deleteDoc, updateDoc, onSnapshot, serverTimestamp 
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // 2. CONFIGURAÇÃO (Usando variáveis de ambiente para evitar quebras)
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
        apiKey: "AIzaSyCWlVvnA29CnKco7mBG6LvpzDtcYmr28cY",
        authDomain: "projetomu-d5722.firebaseapp.com",
        projectId: "projetomu-d5722",
        storageBucket: "projetomu-d5722.firebasestorage.app",
        messagingSenderId: "94478862714",
        appId: "1:94478862714:web:578561a199f685f9e5eec3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'pulse-v1'; 

    // ================= ESTADO GLOBAL =================
    let valuesVisible = true;
    let transacoesCache = [];
    let isFabOpen = false;
    let odometroAtual = 18450;
    let transacaoTipoAtual = 'despesa';
    let relatorioTipoAtual = 'despesa'; 
    let mixedChartInstance = null;
    let donutChartInstance = null;

    const contas = ["Carteira", "Nubank", "Banco do Brasil", "Cartão de Crédito"];
    const categorias = {
        despesa: ["Transporte", "Alimentação", "Moradia", "Lazer", "Veículo", "Outros"],
        receita: ["Salário", "Rendimentos", "Extra", "Vendas"]
    };

    // ================= INICIALIZAÇÃO DE AUTH (RULE 3) =================
    const initAuth = async () => {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
        } else {
            await signInAnonymously(auth);
        }
    };
    initAuth();

    // ================= SINCRONIZAÇÃO EM TEMPO REAL =================
    onAuthStateChanged(auth, (user) => {
        if (user) {
            console.log("✅ Conectado ao ProjetoMu:", user.uid);
            // Seguindo a RULE 1 para dados privados
            const ref = collection(db, 'artifacts', appId, 'users', user.uid, 'transacoes');
            
            onSnapshot(ref, (snap) => {
                let r = 0, g = 0, oMax = odometroAtual, lista = [];
                snap.forEach(d => {
                    const t = { id: d.id, ...d.data() };
                    if (t.efetivada !== false) { 
                        if(t.tipo === 'receita') r += t.valor; else g += t.valor;
                    }
                    if(t.odometro && t.odometro > oMax) oMax = t.odometro;
                    lista.push(t);
                });
                transacoesCache = lista;
                odometroAtual = oMax;
                renderListaFinancas(lista);
                atualizarResumoUI(r, g, oMax);
                
                if (document.getElementById('modal-relatorio-financas') && !document.getElementById('modal-relatorio-financas').classList.contains('translate-y-full')) {
                    updateCharts(lista);
                }
            }, (err) => console.error("Erro Snapshot:", err));
        }
    });

    // ================= FUNÇÕES DE INTERFACE =================
    window.atualizarSelectsDinamicos = () => {
        const selectConta = document.getElementById('transacao-conta');
        const selectCat = document.getElementById('transacao-categoria');
        const selectContaAbs = document.getElementById('abs-conta');
        const selectContaSrv = document.getElementById('srv-conta');

        const htmlContas = contas.map(c => `<option value="${c}">${c}</option>`).join('');
        if(selectConta) selectConta.innerHTML = htmlContas;
        if(selectContaAbs) selectContaAbs.innerHTML = htmlContas;
        if(selectContaSrv) selectContaSrv.innerHTML = htmlContas;

        if(selectCat) {
            const listaCats = categorias[transacaoTipoAtual] || categorias.despesa;
            selectCat.innerHTML = listaCats.map(c => `<option value="${c}">${c}</option>`).join('');
        }
    };

    window.navigate = (clickedElement, pageId, pageTitle) => {
        window.closeFab();
        document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
        const target = document.getElementById(pageId);
        if(target) target.classList.remove('hidden');
        document.getElementById('header-title').innerText = pageTitle;
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.replace('text-[#38bdf8]', 'text-[#8c92a0]');
            const bar = btn.querySelector('div');
            if(bar) bar.classList.replace('w-6', 'w-0');
        });

        if (clickedElement) {
            clickedElement.classList.replace('text-[#8c92a0]', 'text-[#38bdf8]');
            const bar = clickedElement.querySelector('div');
            if(bar) bar.classList.replace('w-0', 'w-6');
        }
    };

    window.toggleFab = () => {
        isFabOpen = !isFabOpen;
        const icon = document.getElementById('fab-icon');
        const btnFinancas = document.getElementById('fab-financas');
        const btnVeiculo = document.getElementById('fab-veiculo');
        const overlay = document.getElementById('fab-overlay');

        if (isFabOpen) {
            if(icon) icon.style.transform = 'rotate(45deg)';
            if(overlay) { overlay.classList.remove('hidden'); setTimeout(() => overlay.classList.remove('opacity-0'), 10); }
            if(btnFinancas) {
                btnFinancas.classList.remove('opacity-0', 'scale-50', 'pointer-events-none');
                btnFinancas.style.transform = 'translate(-45px, -50px)';
            }
            if(btnVeiculo) {
                btnVeiculo.classList.remove('opacity-0', 'scale-50', 'pointer-events-none');
                btnVeiculo.style.transform = 'translate(45px, -50px)';
            }
        } else {
            if(icon) icon.style.transform = 'rotate(0deg)';
            if(overlay) { overlay.classList.add('opacity-0'); setTimeout(() => overlay.classList.add('hidden'), 300); }
            [btnFinancas, btnVeiculo].forEach(btn => {
                if(btn) {
                    btn.classList.add('opacity-0', 'scale-50', 'pointer-events-none');
                    btn.style.transform = 'translate(0px, 0px)';
                }
            });
        }
    };

    window.closeFab = () => { if (isFabOpen) window.toggleFab(); };

    // ================= OPERAÇÕES FINANCEIRAS (CRUD) =================
    window.setTipoTransacao = (tipo) => {
        transacaoTipoAtual = tipo;
        const btnDespesa = document.getElementById('btn-tipo-despesa'); 
        const btnReceita = document.getElementById('btn-tipo-receita');
        const btnSalvar = document.getElementById('btn-salvar-transacao');

        if(tipo === 'despesa') {
            if(btnDespesa) btnDespesa.className = "flex-1 py-2 text-sm font-bold rounded-lg bg-red-400 text-[#121418] shadow-sm transition-all";
            if(btnReceita) btnReceita.className = "flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:text-white transition-all";
            if(btnSalvar) {
                btnSalvar.className = "w-full bg-red-400 text-[#121418] font-bold text-lg py-4 rounded-2xl mt-6 transition-all";
                btnSalvar.innerText = "Lançar Despesa";
            }
        } else {
            if(btnReceita) btnReceita.className = "flex-1 py-2 text-sm font-bold rounded-lg bg-green-400 text-[#121418] shadow-sm transition-all";
            if(btnDespesa) btnDespesa.className = "flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:text-white transition-all";
            if(btnSalvar) {
                btnSalvar.className = "w-full bg-green-400 text-[#121418] font-bold text-lg py-4 rounded-2xl mt-6 transition-all";
                btnSalvar.innerText = "Lançar Receita";
            }
        }
        window.atualizarSelectsDinamicos();
    };

    window.abrirTransacaoFinancas = (tipo) => {
        window.closeFab();
        window.setTipoTransacao(tipo);
        document.getElementById('modal-transacao-financas').classList.remove('translate-y-full');
    };

    window.salvarTransacaoFinancas = async () => {
        const user = auth.currentUser;
        if (!user) return alert("Erro: Utilizador não identificado. Aguarde a conexão.");

        const valInput = document.getElementById('input-valor-transacao');
        const descInput = document.getElementById('transacao-desc');
        const val = parseFloat(valInput.value);
        
        if(!val) return alert("Insira um valor válido!");

        const dados = {
            valor: val,
            descricao: descInput.value || 'Transação',
            categoria: document.getElementById('transacao-categoria').value,
            conta: document.getElementById('transacao-conta').value,
            efetivada: document.getElementById('toggle-efetivada').checked,
            tipo: transacaoTipoAtual,
            updatedAt: serverTimestamp()
        };

        try {
            if(window.editIdAtual) {
                await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'transacoes', window.editIdAtual), dados);
                window.editIdAtual = null;
            } else {
                await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'transacoes'), { ...dados, createdAt: serverTimestamp() });
            }
            
            valInput.value = '';
            descInput.value = '';
            window.fecharTransacaoFinancas();
        } catch (e) { 
            console.error("❌ Erro ao salvar:", e); 
            alert("Erro ao gravar na nuvem.");
        }
    };

    window.excluirTransacao = async (id) => {
        if(confirm("Deseja apagar permanentemente da nuvem?")) {
            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'transacoes', id));
            } catch (e) { console.error("❌ Erro ao excluir:", e); }
        }
    };

    window.preencherEdicao = (id) => {
        const t = transacoesCache.find(x => x.id === id);
        if(!t) return;
        window.editIdAtual = id;
        document.getElementById('modal-titulo-financas').innerText = "Editar Transação";
        document.getElementById('input-valor-transacao').value = t.valor;
        document.getElementById('transacao-desc').value = t.descricao;
        document.getElementById('toggle-efetivada').checked = t.efetivada;
        window.abrirTransacaoFinancas(t.tipo);
    };

    // ================= RELATÓRIOS E GRÁFICOS =================
    window.abrirRelatorioFinancas = () => {
        window.closeFab();
        const modal = document.getElementById('modal-relatorio-financas');
        if(modal) {
            modal.classList.remove('translate-y-full');
            setTimeout(() => initCharts(transacoesCache), 300);
        }
    };

    window.fecharRelatorioFinancas = () => {
        const modal = document.getElementById('modal-relatorio-financas');
        if(modal) modal.classList.add('translate-y-full');
    };

    window.setRelatorioTipo = (tipo) => {
        relatorioTipoAtual = tipo;
        const btnD = document.getElementById('btn-donut-despesa');
        const btnR = document.getElementById('btn-donut-receita');
        
        if(tipo === 'despesa') {
            if(btnD) btnD.className = "text-xs py-1 px-3 rounded-lg bg-red-400 text-[#121418] font-bold transition-all";
            if(btnR) btnR.className = "text-xs py-1 px-3 rounded-lg text-gray-400 hover:text-white transition-all";
        } else {
            if(btnR) btnR.className = "text-xs py-1 px-3 rounded-lg bg-green-400 text-[#121418] font-bold transition-all";
            if(btnD) btnD.className = "text-xs py-1 px-3 rounded-lg text-gray-400 hover:text-white transition-all";
        }
        
        updateCharts(transacoesCache);
    };

    function initCharts(lista) {
        if (!window.Chart) return;
        const ctxMixed = document.getElementById('mixedChart')?.getContext('2d');
        const ctxDonut = document.getElementById('donutChart')?.getContext('2d');

        if (ctxMixed && !mixedChartInstance) {
            mixedChartInstance = new Chart(ctxMixed, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [
                        { type: 'line', label: 'Saldo', data: [0, 0, 0, 0, 0, 0], borderColor: '#38bdf8', tension: 0.3 },
                        { type: 'bar', label: 'Receitas', data: [0, 0, 0, 0, 0, 0], backgroundColor: 'rgba(74, 222, 128, 0.8)' },
                        { type: 'bar', label: 'Despesas', data: [0, 0, 0, 0, 0, 0], backgroundColor: 'rgba(248, 113, 113, 0.8)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#8c92a0' } } } }
            });
        }

        if (ctxDonut && !donutChartInstance) {
            donutChartInstance = new Chart(ctxDonut, {
                type: 'doughnut',
                data: {
                    labels: ['Geral'],
                    datasets: [{ data: [1], backgroundColor: ['#374151'] }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    cutout: '70%', 
                    plugins: { 
                        legend: { 
                            position: 'right', 
                            labels: { color: '#fff', font: { size: 10 }, usePointStyle: true } 
                        } 
                    } 
                }
            });
        }
        updateCharts(lista);
    }

    function updateCharts(lista) {
        if (!mixedChartInstance || !donutChartInstance) return;

        const transacoesFiltradas = lista.filter(t => t.tipo === relatorioTipoAtual);
        const categoriasMap = {};

        transacoesFiltradas.forEach(t => {
            const cat = t.categoria || 'Outros';
            categoriasMap[cat] = (categoriasMap[cat] || 0) + t.valor;
        });

        const labels = Object.keys(categoriasMap);
        const data = Object.values(categoriasMap);
        const cores = relatorioTipoAtual === 'despesa' 
            ? ['#f97316', '#3b82f6', '#8b5cf6', '#eab308', '#ef4444', '#06b6d4'] 
            : ['#4ade80', '#38bdf8', '#a855f7', '#f472b6', '#fbbf24'];

        if (labels.length > 0) {
            donutChartInstance.data.labels = labels;
            donutChartInstance.data.datasets[0].data = data;
            donutChartInstance.data.datasets[0].backgroundColor = cores.slice(0, labels.length);
        } else {
            donutChartInstance.data.labels = ['Sem dados'];
            donutChartInstance.data.datasets[0].data = [1];
            donutChartInstance.data.datasets[0].backgroundColor = ['#374151'];
        }

        donutChartInstance.update();
    }

    // ================= VEÍCULO (ABASTECIMENTO E SERVIÇO) =================
    window.abrirModalAbastecimento = () => {
        window.closeFab();
        window.atualizarSelectsDinamicos();
        document.getElementById('abs-total').value = '';
        document.getElementById('abs-desc').value = '';
        document.getElementById('abs-odometro').value = odometroAtual;
        const modal = document.getElementById('modal-abastecimento');
        if(modal) modal.classList.remove('translate-y-full');
    };

    window.fecharModalAbastecimento = () => {
        const modal = document.getElementById('modal-abastecimento');
        if(modal) modal.classList.add('translate-y-full');
    };

    window.registrarAbastecimento = async () => {
        const user = auth.currentUser;
        if (!user) return alert("Aguarde a ligação...");
        const total = parseFloat(document.getElementById('abs-total').value);
        if(!total) return alert("Insira o valor!");
        const dados = {
            valor: total,
            descricao: document.getElementById('abs-desc').value || "Abastecimento",
            tipo: 'despesa',
            categoria: 'Veículo',
            subcategoria: 'Abastecimento',
            conta: document.getElementById('abs-conta')?.value || 'Carteira',
            odometro: parseInt(document.getElementById('abs-odometro').value) || odometroAtual,
            efetivada: true,
            updatedAt: serverTimestamp(),
            createdAt: serverTimestamp()
        };
        try {
            await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'transacoes'), dados);
            window.fecharModalAbastecimento();
        } catch (e) { console.error("❌ Erro ao abastecer:", e); }
    };

    window.abrirModalServico = () => {
        window.closeFab();
        window.atualizarSelectsDinamicos();
        document.getElementById('srv-total').value = '';
        document.getElementById('srv-odometro').value = odometroAtual;
        const modal = document.getElementById('modal-servico-veiculo');
        if(modal) modal.classList.remove('translate-y-full');
    };

    window.fecharModalServico = () => {
        const modal = document.getElementById('modal-servico-veiculo');
        if(modal) modal.classList.add('translate-y-full');
    };

    window.registrarServico = async () => {
        const user = auth.currentUser;
        if (!user) return alert("Aguarde a ligação...");
        const total = parseFloat(document.getElementById('srv-total').value);
        if(!total) return alert("Insira o valor!");
        const dados = {
            valor: total,
            descricao: document.getElementById('srv-tipo').value || "Serviço",
            tipo: 'despesa',
            categoria: 'Veículo',
            subcategoria: 'Serviço',
            conta: document.getElementById('srv-conta')?.value || 'Carteira',
            odometro: parseInt(document.getElementById('srv-odometro').value) || odometroAtual,
            efetivada: true,
            updatedAt: serverTimestamp(),
            createdAt: serverTimestamp()
        };
        try {
            await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'transacoes'), dados);
            window.fecharModalServico();
        } catch (e) { console.error("❌ Erro ao registar serviço:", e); }
    };

    // ================= RENDERIZAÇÃO E UI =================
    function renderListaFinancas(lista) {
        const container = document.getElementById('lista-transacoes-financas');
        const containerVeiculo = document.getElementById('lista-transacoes-veiculo');
        
        if(container) container.innerHTML = "";
        if(containerVeiculo) containerVeiculo.innerHTML = "";

        lista.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)).forEach(t => {
            const iconName = t.tipo === 'receita' ? 'trending-up' : (t.categoria === 'Veículo' ? 'fuel' : 'shopping-cart');
            const html = `
                <div class="flex justify-between items-center bg-[#1E2128] p-3 rounded-xl border border-gray-800 ${t.efetivada ? '' : 'opacity-60 border-dashed'} animate-fadeIn">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 shrink-0">
                            <i data-lucide="${iconName}" class="w-5 h-5"></i>
                        </div>
                        <div class="truncate">
                            <span class="block text-sm font-medium truncate text-white">${t.descricao}</span>
                            <span class="text-[10px] text-gray-500 uppercase font-bold">${t.categoria} • ${t.efetivada ? 'PAGO' : 'PREVISTO'}</span>
                        </div>
                    </div>
                    <div class="text-right shrink-0">
                        <span class="block text-sm font-bold ${t.tipo === 'receita' ? 'text-green-400' : 'text-red-400'}">
                            ${t.tipo === 'receita' ? '+' : '-'} R$ ${t.valor.toFixed(2)}
                        </span>
                        <div class="flex space-x-3 mt-1.5 justify-end">
                            <button onclick="preencherEdicao('${t.id}')" class="text-gray-500 hover:text-white transition-colors"><i data-lucide="edit-2" class="w-3.5 h-3.5"></i></button>
                            <button onclick="excluirTransacao('${t.id}')" class="text-gray-500 hover:text-red-400 transition-colors"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                        </div>
                    </div>
                </div>`;
            
            if(container) container.insertAdjacentHTML('beforeend', html);
            if(containerVeiculo && t.categoria === 'Veículo') containerVeiculo.insertAdjacentHTML('beforeend', html);
        });
        lucide.createIcons();
    }

    function atualizarResumoUI(receita, gasto, odo) {
        const fmt = (v) => v.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
        const saldo = receita - gasto;
        
        const elements = {
            'resumo-disponivel': `R$ ${fmt(saldo)}`,
            'home-saldo': `R$ ${fmt(saldo)}`,
            'resumo-gasto': `R$ ${fmt(gasto)}`,
            'resumo-receita': `R$ ${fmt(receita)}`,
            'veiculo-hero-odometro': odo.toLocaleString('pt-BR'),
            'home-odo-display': `${odo.toLocaleString('pt-BR')} km`
        };

        for (let id in elements) {
            const el = document.getElementById(id);
            if(el) {
                el.setAttribute('data-value', elements[id]);
                el.innerText = valuesVisible ? elements[id] : (id.includes('odo') ? elements[id] : 'R$ •••••');
            }
        }
    }

    const btnZerar = document.getElementById("btn-zerar");
    if(btnZerar) {
        btnZerar.onclick = async () => {
            const user = auth.currentUser;
            if (!user) return alert("Aguarde a ligação...");
            if (!confirm("Isso apagará TODAS as transações da nuvem permanentemente. Confirma?")) return;
            const ref = collection(db, 'artifacts', appId, 'users', user.uid, 'transacoes');
            const snap = await getDocs(ref);
            await Promise.all(snap.docs.map(d => deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'transacoes', d.id))));
            alert("Base de dados limpa! ✅");
        };
    }

    window.toggleVisibility = () => {
        valuesVisible = !valuesVisible;
        const eye = document.getElementById('icon-eye'); 
        const eyeOff = document.getElementById('icon-eye-off');
        if(eye && eyeOff) { eye.classList.toggle('hidden', !valuesVisible); eyeOff.classList.toggle('hidden', valuesVisible); }
        document.querySelectorAll('.sensitive-value').forEach(el => { 
            const val = el.getAttribute('data-value') || 'R$ 0,00';
            el.innerText = valuesVisible ? val : 'R$ •••••'; 
        });
    };

    window.fecharTransacaoFinancas = () => {
        window.editIdAtual = null;
        const modal = document.getElementById('modal-transacao-financas');
        if (modal) modal.classList.add('translate-y-full');
    };

    window.onload = () => { 
        lucide.createIcons(); 
        window.atualizarSelectsDinamicos();
    };
</script>
	
	
</body>
</html>
