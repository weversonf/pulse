<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PULSE OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .pulse-check input:checked + div { background-color: #2563eb; border-color: #2563eb; }
        .pulse-check input:checked + div svg { opacity: 1; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #3b82f6; cursor: pointer; margin-top: -8px; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #1e293b; border-radius: 2px; }
        ::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; opacity: 0.5; }
        
        /* Estilos do Login */
        .pulse-input { background: #0f172a; border: 1px solid rgba(255,255,255,0.05); border-radius: 1rem; padding: 1rem; font-size: 0.85rem; font-weight: 700; color: #f8fafc; outline: none; width: 100%; transition: all 0.2s; }
        .pulse-input:focus { border-color: #3b82f6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.1); }
        .loader { width: 20px; height: 20px; border: 3px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 italic selection:bg-blue-500/30">

    <!-- TELA DE LOGIN -->
    <div id="login-screen" class="fixed inset-0 z-[200] bg-slate-950 flex flex-col items-center justify-center p-6 transition-all duration-500">
        <div class="w-full max-w-sm space-y-8 text-center">
            <div class="space-y-2">
                <h1 class="text-5xl font-black tracking-tighter text-blue-500 leading-none">PULSE</h1>
                <p class="text-[10px] font-black uppercase tracking-[0.4em] text-slate-500">SaaS Operacional ‚Ä¢ Pessoal</p>
            </div>
            
            <div class="bg-slate-900/50 p-8 rounded-[3rem] border border-white/5 space-y-4 shadow-2xl relative overflow-hidden">
                <div class="space-y-4 relative z-10">
                    <input type="text" id="login-user" placeholder="USU√ÅRIO" class="pulse-input text-center uppercase">
                    <input type="password" id="login-pass" placeholder="SENHA" class="pulse-input text-center">
                    <button onclick="window.handleLogin()" id="btn-login-action" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase text-xs tracking-widest shadow-lg shadow-blue-500/20 active:scale-95 transition-all flex items-center justify-center gap-2">
                        <span>Entrar</span>
                    </button>
                </div>
                <div class="absolute -bottom-10 -right-10 w-32 h-32 bg-blue-500/5 rounded-full blur-3xl"></div>
            </div>
            <p id="login-error" class="text-[10px] text-red-500 font-bold uppercase hidden bg-red-500/10 p-3 rounded-xl border border-red-500/20"></p>
        </div>
    </div>

    <!-- MODAL TROCA DE SENHA -->
    <div id="modal-change-pass" class="fixed inset-0 z-[300] bg-black/95 backdrop-blur-xl hidden flex-col items-center justify-center p-6">
        <div class="bg-slate-900 border border-orange-500/30 p-8 rounded-[3rem] w-full max-w-sm shadow-2xl space-y-6">
            <div class="text-center">
                <div class="w-16 h-16 bg-orange-500/10 text-orange-500 rounded-3xl flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="shield-alert" class="w-8 h-8"></i>
                </div>
                <h3 class="text-xl font-black text-white uppercase tracking-tighter leading-tight">Seguran√ßa Obrigat√≥ria</h3>
                <p class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest">Altere a senha padr√£o "123456" para prosseguir.</p>
            </div>
            <div class="space-y-3">
                <input type="password" id="new-pass" placeholder="NOVA SENHA" class="pulse-input border-orange-500/20">
                <input type="password" id="confirm-pass" placeholder="CONFIRMAR SENHA" class="pulse-input border-orange-500/20">
                <button onclick="window.submitNewPassword()" id="btn-change-pass" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-black uppercase text-xs tracking-widest active:scale-95 transition-all">Atualizar e Entrar</button>
            </div>
        </div>
    </div>

    <!-- APP PRINCIPAL (Oculto at√© o login) -->
    <div id="app-content" class="hidden flex min-h-screen relative">
        
        <!-- SIDEBAR -->
        <aside class="hidden md:flex flex-col w-64 bg-slate-900 border-r border-white/5 fixed h-full z-50 p-6">
            <div class="mb-10">
                <h1 class="text-3xl font-black tracking-tighter text-blue-500 leading-none">PULSE</h1>
                <p class="text-[9px] font-black uppercase tracking-[0.3em] text-slate-500 mt-2">OS ‚Ä¢ Enterprise</p>
            </div>

            <nav class="flex-1 space-y-2">
                <button onclick="window.openTab('dashboard')" class="side-nav-btn w-full flex items-center gap-4 px-4 py-4 rounded-2xl transition-all text-blue-500 bg-blue-500/10 font-black uppercase text-[10px] tracking-widest" id="side-btn-dashboard">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Dashboard
                </button>
                <button onclick="window.openTab('saude')" class="side-nav-btn w-full flex items-center gap-4 px-4 py-4 rounded-2xl transition-all text-slate-500 hover:bg-white/5 font-black uppercase text-[10px] tracking-widest" id="side-btn-saude">
                    <i data-lucide="activity" class="w-5 h-5"></i> Sa√∫de
                </button>
                <button onclick="window.openTab('bike')" class="side-nav-btn w-full flex items-center gap-4 px-4 py-4 rounded-2xl transition-all text-slate-500 hover:bg-white/5 font-black uppercase text-[10px] tracking-widest" id="side-btn-bike">
                    <i data-lucide="bike" class="w-5 h-5"></i> <span class="side-bike-name">Ve√≠culo</span>
                </button>
                <button onclick="window.openTab('work')" class="side-nav-btn w-full flex items-center gap-4 px-4 py-4 rounded-2xl transition-all text-slate-500 hover:bg-white/5 font-black uppercase text-[10px] tracking-widest" id="side-btn-work">
                    <i data-lucide="briefcase" class="w-5 h-5"></i> WORK
                </button>
                <button onclick="window.openTab('financas')" class="side-nav-btn w-full flex items-center gap-4 px-4 py-4 rounded-2xl transition-all text-slate-500 hover:bg-white/5 font-black uppercase text-[10px] tracking-widest" id="side-btn-financas">
                    <i data-lucide="wallet" class="w-5 h-5"></i> Finan√ßas
                </button>
            </nav>

            <div class="mt-auto pt-6 border-t border-white/5 space-y-3 text-center">
                <div class="flex flex-col gap-2 p-4 bg-slate-950 rounded-2xl border border-white/5">
                    <div id="cloud-status" class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                        <span class="text-[8px] font-black uppercase tracking-widest text-slate-500">Offline</span>
                    </div>
                    <div class="space-y-1 border-t border-white/5 pt-2">
                        <p id="side-location" class="text-[9px] font-black uppercase text-blue-500 tracking-tighter">FORTALEZA, CE</p>
                        <p id="side-weather" class="text-[10px] font-bold text-slate-400">30¬∞C ‚Ä¢ Ensolarado</p>
                    </div>
                </div>
                <div class="flex flex-col gap-1">
                    <button onclick="window.openTab('config')" class="w-full flex items-center gap-4 px-4 py-3 rounded-2xl transition-all text-slate-500 hover:text-white hover:bg-white/5 font-black uppercase text-[9px] tracking-widest" id="side-btn-config">
                        <i data-lucide="settings" class="w-4 h-4"></i> Ajustes
                    </button>
                    <button onclick="location.reload()" class="w-full text-[8px] font-black uppercase text-red-500/50 hover:text-red-500 py-2">Sair do Sistema</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 md:ml-64 transition-all duration-300">
            <header class="bg-slate-900/80 backdrop-blur-xl sticky top-0 z-40 px-6 py-5 flex items-center justify-between border-b border-white/5">
                <div class="md:hidden">
                    <h1 class="text-2xl font-black tracking-tighter text-blue-500 leading-none">PULSE</h1>
                    <h2 id="current-location" class="text-[9px] font-black uppercase tracking-[0.3em] text-slate-500 mt-1 leading-none">FORTALEZA ‚Ä¢ 30¬∞C</h2>
                </div>
                <div class="hidden md:block">
                    <h2 class="text-[10px] font-black uppercase tracking-[0.4em] text-slate-500 flex items-center gap-2">
                        SaaS Operacional ‚Ä¢ <span id="desktop-loc">FORTALEZA</span> 
                        <span class="text-slate-700">|</span> 
                        <span id="header-weather-info" class="text-blue-500">30¬∞C <i data-lucide="sun" class="inline w-3 h-3"></i></span>
                    </h2>
                </div>
                <button onclick="window.addMonster()" class="w-12 h-12 rounded-2xl bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center text-emerald-400 active:scale-90 transition-all">
                    <i data-lucide="zap" class="w-6 h-6"></i>
                </button>
            </header>

            <main class="max-w-4xl mx-auto p-4 md:p-8 space-y-6 pb-28 md:pb-12">
                
                <!-- DASHBOARD -->
                <section id="dashboard" class="tab-content active space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-emerald-950/40 border border-emerald-500/20 p-5 rounded-[2rem] flex flex-col justify-end min-h-[140px]">
                            <p class="text-3xl font-black tracking-tighter leading-none mb-1 text-emerald-400">R$ <span id="dash-saldo">0</span></p>
                            <p class="text-[9px] font-black uppercase tracking-widest text-emerald-500/60 leading-none">Saldo</p>
                        </div>
                        <div class="bg-indigo-950/40 border border-indigo-500/20 p-5 rounded-[2rem] flex flex-col justify-end min-h-[140px]">
                            <p class="text-3xl font-black tracking-tighter leading-none mb-1 text-indigo-400">R$ <span id="dash-fundo">0</span></p>
                            <p class="text-[9px] font-black uppercase tracking-widest text-indigo-500/60 leading-none">Fundo Rota</p>
                        </div>
                    </div>
                    <div class="bg-slate-900 border border-white/5 p-6 rounded-[2.5rem]" onclick="window.openTab('bike')">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-2.5 bg-blue-500/10 rounded-xl text-blue-500"><i data-lucide="bike" class="w-5 h-5"></i></div>
                            <p class="text-[10px] font-black uppercase tracking-widest text-blue-400"><span id="dash-consumo-moto">29</span> KM/L</p>
                        </div>
                        <p class="text-4xl font-black tracking-tighter leading-none mb-2 text-white"><span id="dash-km-atual">0</span><span class="text-xs ml-1 text-slate-600 font-bold uppercase">KM</span></p>
                        <div class="w-full bg-slate-950 h-1.5 rounded-full overflow-hidden mb-2">
                            <div id="dash-oil-bar" class="bg-orange-500 h-full transition-all" style="width: 0%"></div>
                        </div>
                        <p id="dash-oil-text" class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-500">√ìLEO EM 5000 KM</p>
                    </div>
                    <div class="bg-slate-900/40 p-6 rounded-[2.5rem] border border-white/5">
                        <p class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 mb-4 flex items-center gap-2"><i data-lucide="bell" class="w-3 h-3 text-red-500"></i> Alertas Ativos</p>
                        <ul class="space-y-3" id="dash-docs-list"></ul>
                    </div>
                </section>

                <!-- SA√öDE -->
                <section id="saude" class="tab-content space-y-4">
                    <div class="bg-slate-900 border border-white/5 p-6 rounded-[2.5rem]">
                        <div class="mb-6">
                            <div class="flex justify-between text-[9px] font-black uppercase tracking-widest text-blue-500 mb-2 leading-none">
                                <span>Hidrata√ß√£o (Meta 3500ml)</span>
                                <span id="water-percent-text">0%</span>
                            </div>
                            <div class="w-full bg-slate-950 h-2 rounded-full overflow-hidden shadow-inner">
                                <div id="water-bar" class="bg-blue-500 h-full transition-all duration-1000" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="window.addWaterWork()" class="bg-blue-600 p-4 rounded-3xl active:scale-95 transition-all text-center">
                                <p class="text-lg font-black leading-none">473ml</p>
                                <p class="text-[8px] font-black uppercase opacity-60 mt-1 leading-none">Makro Eng.</p>
                                <p id="water-work-count" class="text-[9px] mt-2 font-bold text-blue-200">0/6</p>
                            </button>
                            <button onclick="window.addWaterHome()" class="bg-slate-800 p-4 rounded-3xl border border-white/5 active:scale-95 transition-all text-center">
                                <p class="text-lg font-black leading-none">250ml</p>
                                <p class="text-[8px] font-black uppercase opacity-60 mt-1 leading-none">Home</p>
                                <p id="water-home-count" class="text-[9px] mt-2 font-bold text-slate-400">0/2</p>
                            </button>
                        </div>
                        <button onclick="window.resetWater()" class="w-full mt-4 text-[9px] uppercase tracking-widest text-slate-500 font-bold">Zerar dia</button>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 flex flex-col items-center">
                        <p class="text-5xl font-black tracking-tighter text-white" id="clean-days-count">0</p>
                        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-500 mt-2">Dias Limpo</p>
                        <div class="w-full mt-6 space-y-2">
                            <div class="flex justify-between text-[9px] font-black uppercase tracking-widest"><span class="text-slate-500">Meta: <span id="clean-goal-text">30</span> Dias</span><span class="text-indigo-400" id="clean-percent-text">0%</span></div>
                            <div class="w-full bg-slate-950 h-2 rounded-full overflow-hidden"><div id="clean-bar" class="bg-indigo-500 h-full transition-all duration-1000" style="width: 0%"></div></div>
                        </div>
                    </div>
                </section>

                <!-- VE√çCULO -->
                <section id="bike" class="tab-content space-y-4">
                    <div class="bg-blue-600 p-6 rounded-[2.5rem] flex items-center justify-between">
                        <div>
                            <h3 id="bike-header-name" class="font-black text-2xl uppercase tracking-tighter text-white">Fazer 250</h3>
                            <p class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-200 mt-1">Status do Ve√≠culo</p>
                        </div>
                        <i data-lucide="bike" class="w-12 h-12 text-blue-200 opacity-50"></i>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 space-y-3">
                        <select id="servico-tipo" onchange="window.toggleServicoFields()" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                            <option value="Abastecimento">‚õΩ Abastecimento</option>
                            <option value="Troca de √ìleo">üõ¢Ô∏è Troca de √ìleo</option>
                            <option value="Manuten√ß√£o">üîß Manuten√ß√£o Geral</option>
                        </select>
                        <div class="grid grid-cols-2 gap-3">
                            <input type="number" id="servico-km" placeholder="KM Atual" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                            <input type="number" id="servico-valor" placeholder="Valor Total" oninput="window.calcCombustivel()" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                        </div>
                        <div id="campos-abastecimento" class="hidden grid grid-cols-2 gap-3 transition-all">
                            <input type="number" id="servico-preco-litro" placeholder="R$/Litro" oninput="window.calcCombustivel()" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300">
                            <input type="number" id="servico-litros" placeholder="Total Litros" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold outline-none text-slate-300" readonly>
                        </div>
                        <button onclick="window.lancarServico()" class="w-full bg-slate-800 text-slate-300 py-4 rounded-2xl font-black uppercase tracking-widest text-[10px]">Registrar</button>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5">
                        <div class="flex justify-between items-end mb-4"><label class="text-[9px] font-black uppercase text-slate-500 tracking-[0.2em]">Planeador de Rota</label><span class="font-black text-2xl text-white"><span id="trip-dist-display">100</span><small class="text-xs text-slate-500 ml-1">KM</small></span></div>
                        <input type="range" id="trip-slider" min="1" max="1000" value="100" oninput="window.calcularViagemPulse()" class="w-full">
                        <div class="grid grid-cols-2 gap-4 p-5 bg-indigo-500/10 rounded-3xl mt-4 border border-indigo-500/20">
                            <div><p class="text-[8px] font-black text-slate-400 uppercase">Litros</p><p class="text-xl font-black text-indigo-400"><span id="trip-litros">3.4</span> L</p></div>
                            <div><p class="text-[8px] font-black text-slate-400 uppercase">Custo Est.</p><p class="text-xl font-black text-emerald-400">R$ <span id="trip-custo">0</span></p></div>
                        </div>
                    </div>
                </section>

                <!-- WORK -->
                <section id="work" class="tab-content space-y-4">
                    <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 space-y-3">
                        <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500 flex items-center gap-2"><i data-lucide="briefcase" class="w-4 h-4"></i> Makro Atividades</h3>
                        <input type="text" id="work-task-title" placeholder="Atividade..." class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                        <div class="grid grid-cols-2 gap-3">
                            <input type="text" id="work-task-requester" placeholder="Solicitante" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                            <input type="date" id="work-task-deadline" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-400 outline-none">
                        </div>
                        <button onclick="window.addWorkTask()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Lan√ßar</button>
                        <div class="overflow-x-auto pt-4">
                            <table class="w-full text-left">
                                <thead class="text-[8px] font-black uppercase text-slate-500 tracking-widest border-b border-white/5">
                                    <tr><th class="pb-3 px-2">Tarefa</th><th class="pb-3 px-2">Solicitante</th><th class="pb-3 px-2 text-right">A√ß√£o</th></tr>
                                </thead>
                                <tbody id="work-task-active-list" class="divide-y divide-white/5"></tbody>
                            </table>
                        </div>
                    </div>
                    <button onclick="window.toggleArchive()" class="flex items-center gap-2 text-[9px] font-black uppercase tracking-widest text-slate-600 hover:text-slate-400 ml-4"><i id="archive-toggle-icon" data-lucide="chevron-right" class="w-3 h-3"></i> Arquivados (<span id="archive-count">0</span>)</button>
                    <div id="work-archive-section" class="hidden bg-slate-900/50 p-6 rounded-[2.5rem] border border-dashed border-white/5 overflow-x-auto">
                        <table class="w-full text-left opacity-60"><tbody id="work-task-archived-list" class="divide-y divide-white/5"></tbody></table>
                    </div>
                </section>

                <!-- FINAN√áAS -->
                <section id="financas" class="tab-content space-y-4">
                    <div class="bg-slate-900 border border-white/5 p-6 rounded-[2.5rem]"><p class="text-[10px] font-black uppercase tracking-[0.3em] text-emerald-500 mb-2 leading-none">Saldo em Conta</p><p class="text-4xl font-black tracking-tighter text-white">R$ <span id="fin-saldo-atual-pag">0</span></p></div>
                    <div class="bg-slate-900/40 p-6 rounded-[2.5rem] border border-white/5 space-y-3">
                        <div class="grid grid-cols-2 gap-2"><select id="fin-categoria" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none"></select><input type="number" id="fin-valor" placeholder="R$ 0,00" class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none"></div>
                        <input type="text" id="fin-desc" placeholder="Descri√ß√£o..." class="w-full p-4 bg-slate-950 border border-white/5 rounded-2xl text-xs font-bold text-slate-300 outline-none">
                        <div class="grid grid-cols-2 gap-3"><button onclick="window.lancarFinanca('receita')" class="bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 py-4 rounded-2xl font-black uppercase text-[10px]">Entrada</button><button onclick="window.lancarFinanca('despesa')" class="bg-red-500/10 text-red-500 border border-red-500/20 py-4 rounded-2xl font-black uppercase text-[10px]">Sa√≠da</button></div>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 space-y-3" id="fin-history-list"></div>
                </section>

                <!-- AJUSTES -->
                <section id="config" class="tab-content space-y-4">
                    <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 text-xs font-bold text-slate-400 space-y-4">
                        <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500 flex items-center gap-2"><i data-lucide="bike" class="w-4 h-4"></i> Ve√≠culo (Yamaha Fazer)</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block mb-1 uppercase text-[8px]">Tipo</label><select id="veiculo-tipo" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-slate-300"><option value="Moto">Moto</option><option value="Carro">Carro</option></select></div>
                            <div><label class="block mb-1 uppercase text-[8px]">Montadora</label><select id="veiculo-montadora" onchange="window.updateModelDropdown()" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-slate-300"><option value="Yamaha">Yamaha</option><option value="Honda">Honda</option><option value="BMW">BMW</option></select></div>
                        </div>
                        <div><label class="block mb-1 uppercase text-[8px]">Modelo</label><select id="veiculo-modelo" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-slate-300"></select></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block mb-1 uppercase text-[8px]">KM Atual</label><input type="number" id="veiculo-km-atual" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-slate-300"></div>
                            <div><label class="block mb-1 uppercase text-[8px]">KM √ìleo</label><input type="number" id="veiculo-km-oleo" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-slate-300"></div>
                        </div>
                    </div>
                    <div class="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 text-xs font-bold text-slate-400 space-y-4">
                        <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-indigo-500 flex items-center gap-2"><i data-lucide="shield-check" class="w-4 h-4"></i> Disciplina</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block mb-1 uppercase text-[8px]">In√≠cio</label><input type="date" id="clean-start-date" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-slate-300"></div>
                            <div><label class="block mb-1 uppercase text-[8px]">Meta (Dias)</label><input type="number" id="clean-goal-days" class="w-full p-3 bg-slate-950 border border-white/5 rounded-xl text-slate-300"></div>
                        </div>
                    </div>
                    <button onclick="window.saveConfig()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Salvar no Cloud</button>
                </section>
            </main>
        </div>
    </div>

    <!-- Navigation Mobile -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 h-20 bg-slate-900/90 backdrop-blur-2xl border-t border-white/5 z-50">
        <div class="flex justify-around items-center h-full max-w-lg mx-auto">
            <button onclick="window.openTab('dashboard')" class="nav-btn flex flex-col items-center gap-1 text-blue-500"><i data-lucide="layout-dashboard" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Home</span></button>
            <button onclick="window.openTab('saude')" class="nav-btn flex flex-col items-center gap-1 text-slate-500"><i data-lucide="activity" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Sa√∫de</span></button>
            <button onclick="window.openTab('bike')" class="nav-btn flex flex-col items-center gap-1 text-slate-500"><i data-lucide="bike" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Fazer</span></button>
            <button onclick="window.openTab('work')" class="nav-btn flex flex-col items-center gap-1 text-slate-500"><i data-lucide="briefcase" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Work</span></button>
            <button onclick="window.openTab('financas')" class="nav-btn flex flex-col items-center gap-1 text-slate-500"><i data-lucide="wallet" class="w-5 h-5"></i><span class="text-[7px] font-black uppercase">Finan√ßas</span></button>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwVDkNFRuFNyTh3We_8qvlrSDIa3G_y1Owo_l8K47qmw_tlwv3I-EMBfRplkYX6EkMUQw/exec";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'pulse-os-v2';

        const categories = ["Makro Eng.", "Sal√°rio", "Alimenta√ß√£o", "Ve√≠culo", "Lazer", "Contas", "Outros"];
        const modelsByBrand = {
            "Yamaha": ["Fazer 250", "MT-03", "Lander 250"],
            "Honda": ["CB 300F", "XRE 300", "CG 160"],
            "BMW": ["G 310 GS", "F 850 GS"]
        };

        let appState = {
            user: null,
            saldo: 0, fundoRota: 0, transacoes: [], tarefas: [],
            water: { work: 0, home: 0 },
            veiculo: { km: 0, oleo: 0, consumo: 29, montadora: 'Yamaha', modelo: 'Fazer 250', tipo: 'Moto' }
        };

        // GOOGLE SHEETS COMMS
        const gRequest = async (payload) => {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("GRequest Error:", error);
                throw error;
            }
        };

        // LOGIN L√ìGICA
        window.handleLogin = async () => {
            const login = document.getElementById('login-user').value;
            const pass = document.getElementById('login-pass').value;
            const btn = document.getElementById('btn-login-action');
            const error = document.getElementById('login-error');

            if(!login || !pass) return;
            btn.innerHTML = `<span class="loader"></span>`;
            btn.disabled = true;
            error.classList.add('hidden');

            try {
                const res = await gRequest({ action: 'login', login, pass });
                if(res.success) {
                    appState.user = { login, name: res.name };
                    if(res.forceChange) {
                        document.getElementById('modal-change-pass').classList.remove('hidden');
                        document.getElementById('modal-change-pass').classList.add('flex');
                    } else {
                        enterApp(res.name);
                    }
                } else {
                    error.innerText = res.message || "Credenciais inv√°lidas";
                    error.classList.remove('hidden');
                }
            } catch(e) {
                error.innerText = "Erro de conex√£o com servidor Google";
                error.classList.remove('hidden');
            } finally {
                btn.innerHTML = "Entrar";
                btn.disabled = false;
            }
        };

        window.submitNewPassword = async () => {
            const newPass = document.getElementById('new-pass').value;
            const confirm = document.getElementById('confirm-pass').value;
            const btn = document.getElementById('btn-change-pass');

            if(newPass !== confirm || newPass.length < 4) return alert("Verifique as senhas informadas");
            
            btn.innerHTML = `<span class="loader"></span>`;
            btn.disabled = true;

            try {
                const res = await gRequest({ action: 'updatePassword', login: appState.user.login, newPass });
                if(res.success) {
                    document.getElementById('modal-change-pass').classList.add('hidden');
                    enterApp(appState.user.name);
                }
            } catch(e) {
                alert("Falha ao atualizar senha no servidor");
            } finally {
                btn.innerText = "Atualizar e Entrar";
                btn.disabled = false;
            }
        };

        const enterApp = (name) => {
            document.getElementById('login-screen').classList.add('translate-y-[-100%]');
            setTimeout(() => {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                lucide.createIcons();
                updateUI();
            }, 500);
        };

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else { await signInAnonymously(auth); }
        };

        onAuthStateChanged(auth, user => {
            const statusEl = document.getElementById('cloud-status');
            if (user) {
                statusEl.innerHTML = `<div class="w-2 h-2 rounded-full bg-emerald-500"></div><span class="text-[8px] font-black uppercase tracking-widest text-emerald-500">Online</span>`;
                loadCloudData(user.uid);
            }
        });

        const loadCloudData = (userId) => {
            const path = doc(db, 'artifacts', appId, 'users', userId, 'data', 'main');
            onSnapshot(path, snapshot => {
                if (snapshot.exists()) { 
                    const data = snapshot.data();
                    appState = { ...appState, ...data }; 
                    if(appState.user) updateUI(); 
                }
            }, err => console.error("Sync Error:", err));
        };

        const saveCloudData = async () => {
            if (!auth.currentUser) return;
            const path = doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'data', 'main');
            await setDoc(path, appState, { merge: true });
        };

        const updateUI = () => {
            if(!appState.user) return;
            
            document.getElementById('dash-saldo').innerText = appState.saldo.toFixed(0);
            document.getElementById('dash-fundo').innerText = appState.fundoRota.toFixed(0);
            document.getElementById('fin-saldo-atual-pag').innerText = appState.saldo.toFixed(0);
            document.getElementById('dash-km-atual').innerText = appState.veiculo.km;
            
            const oilDiff = appState.veiculo.km - appState.veiculo.oleo;
            document.getElementById('dash-oil-bar').style.width = Math.min((oilDiff/5000)*100, 100) + '%';
            document.getElementById('dash-oil-text').innerText = `√ìLEO EM ${Math.max(0, 5000 - oilDiff)} KM`;
            
            const totalWater = (appState.water.work * 473) + (appState.water.home * 250);
            const waterPerc = Math.min((totalWater / 3500) * 100, 100);
            document.getElementById('water-percent-text').innerText = waterPerc.toFixed(0) + '%';
            document.getElementById('water-bar').style.width = waterPerc + '%';
            document.getElementById('water-work-count').innerText = `${appState.water.work}/6`;
            document.getElementById('water-home-count').innerText = `${appState.water.home}/2`;

            const start = localStorage.getItem('cleanStartDate');
            let days = start ? Math.floor((new Date() - new Date(start)) / 86400000) : 0;
            const goal = parseInt(localStorage.getItem('cleanGoalDays')) || 30;
            document.getElementById('clean-days-count').innerText = days;
            document.getElementById('clean-bar').style.width = Math.min((days/goal)*100, 100) + '%';
            document.getElementById('clean-percent-text').innerText = Math.min((days/goal)*100, 100).toFixed(0) + '%';

            renderFinances(); renderWork(); renderAlerts();
            lucide.createIcons();
        };

        window.openTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn, .side-nav-btn').forEach(b => {
                b.classList.remove('text-blue-500', 'bg-blue-500/10'); b.classList.add('text-slate-500');
            });
            lucide.createIcons();
        };

        window.updateModelDropdown = () => {
            const brand = document.getElementById('veiculo-montadora').value;
            const modelSelect = document.getElementById('veiculo-modelo');
            const models = modelsByBrand[brand] || [];
            modelSelect.innerHTML = models.map(m => `<option value="${m}">${m}</option>`).join('');
        };

        window.lancarServico = () => {
            const km = parseInt(document.getElementById('servico-km').value);
            const val = parseFloat(document.getElementById('servico-valor').value);
            const tipo = document.getElementById('servico-tipo').value;
            if (isNaN(km) || isNaN(val)) return;
            appState.veiculo.km = km;
            if (tipo === 'Troca de √ìleo') appState.veiculo.oleo = km;
            appState.saldo -= val;
            appState.transacoes.push({ id: Date.now(), tipo: 'despesa', cat: 'Ve√≠culo', desc: tipo, valor: val, data: new Date().toLocaleDateString('pt-BR') });
            saveCloudData();
        };

        window.calcularViagemPulse = () => {
            const dist = parseFloat(document.getElementById('trip-slider').value);
            document.getElementById('trip-dist-display').innerText = dist;
            const litros = dist / appState.veiculo.consumo;
            document.getElementById('trip-litros').innerText = litros.toFixed(1);
            document.getElementById('trip-custo').innerText = (litros * 6.10).toFixed(0);
        };

        window.addWorkTask = () => {
            const t = document.getElementById('work-task-title').value; if (!t) return;
            appState.tarefas.push({ id: Date.now(), titulo: t, solicitante: document.getElementById('work-task-requester').value || 'Makro Eng.', data: document.getElementById('work-task-deadline').value, arquivada: false });
            document.getElementById('work-task-title').value = ''; saveCloudData();
        };

        window.concluirTarefa = (id) => { const t = appState.tarefas.find(x => x.id === id); if (t) t.arquivada = true; saveCloudData(); };
        window.deletarTarefa = (id) => { appState.tarefas = appState.tarefas.filter(t => t.id !== id); saveCloudData(); };
        window.toggleArchive = () => { document.getElementById('work-archive-section').classList.toggle('hidden'); };

        window.lancarFinanca = (tipo) => {
            const val = parseFloat(document.getElementById('fin-valor').value); if (isNaN(val)) return;
            appState.transacoes.push({ id: Date.now(), tipo, cat: document.getElementById('fin-categoria').value, desc: document.getElementById('fin-desc').value || 'Geral', valor: val, data: new Date().toLocaleDateString('pt-BR') });
            appState.saldo += (tipo === 'receita' ? val : -val); saveCloudData();
        };

        window.addWaterWork = () => { if(appState.water.work < 6) { appState.water.work++; saveCloudData(); } };
        window.addWaterHome = () => { if(appState.water.home < 2) { appState.water.home++; saveCloudData(); } };
        window.resetWater = () => { appState.water = { work: 0, home: 0 }; saveCloudData(); };
        window.addMonster = () => { appState.saldo -= 10; window.lancarFinanca('despesa'); saveCloudData(); };

        window.saveConfig = () => {
            appState.veiculo.montadora = document.getElementById('veiculo-montadora').value;
            appState.veiculo.modelo = document.getElementById('veiculo-modelo').value;
            appState.veiculo.tipo = document.getElementById('veiculo-tipo').value;
            appState.veiculo.km = parseInt(document.getElementById('veiculo-km-atual').value) || 0;
            appState.veiculo.oleo = parseInt(document.getElementById('veiculo-km-oleo').value) || 0;
            localStorage.setItem('cleanStartDate', document.getElementById('clean-start-date').value);
            localStorage.setItem('cleanGoalDays', document.getElementById('clean-goal-days').value);
            saveCloudData(); window.openTab('dashboard');
        };

        const renderFinances = () => {
            const list = document.getElementById('fin-history-list');
            const catSelect = document.getElementById('fin-categoria');
            if(!list || !catSelect) return;
            catSelect.innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');
            list.innerHTML = appState.transacoes.slice().reverse().map(t => `<div class="flex justify-between items-center p-4 bg-slate-950 rounded-2xl border border-white/5"><div><p class="text-xs font-bold text-slate-300">${t.desc}</p><p class="text-[8px] font-black uppercase text-slate-600">${t.cat} ‚Ä¢ ${t.data}</p></div><p class="text-xs font-black ${t.tipo === 'receita' ? 'text-emerald-400' : 'text-red-400'}">${t.tipo === 'receita' ? '+' : '-'} R$ ${t.valor.toFixed(0)}</p></div>`).join('');
        };

        const renderWork = () => {
            const active = appState.tarefas.filter(t => !t.arquivada);
            const archived = appState.tarefas.filter(t => t.arquivada);
            const archCount = document.getElementById('archive-count');
            const actList = document.getElementById('work-task-active-list');
            const archList = document.getElementById('work-task-archived-list');
            if(archCount) archCount.innerText = archived.length;
            if(actList) actList.innerHTML = active.map(t => `<tr class="text-[10px] font-bold"><td class="py-4 px-2 text-slate-300">${t.titulo}</td><td class="py-4 px-2 text-slate-500">${t.solicitante}</td><td class="py-4 px-2 text-right"><button onclick="window.concluirTarefa(${t.id})" class="text-emerald-500"><i data-lucide="check-circle" class="w-4 h-4"></i></button></td></tr>`).join('');
            if(archList) archList.innerHTML = archived.map(t => `<tr class="text-[9px] opacity-60"><td class="py-2 px-2 line-through">${t.titulo}</td><td class="py-2 px-2">${t.solicitante}</td><td class="py-2 px-2 text-right"><button onclick="window.deletarTarefa(${t.id})" class="text-red-500"><i data-lucide="trash" class="w-3 h-3"></i></button></td></tr>`).join('');
        };

        const renderAlerts = () => {
            const list = document.getElementById('dash-docs-list'); 
            if(!list) return;
            list.innerHTML = '';
            const tasksCount = appState.tarefas.filter(t => !t.arquivada).length;
            if (tasksCount > 0) list.innerHTML += `<li class="p-3 bg-blue-500/10 border border-blue-500/20 rounded-2xl flex items-center gap-3"><i data-lucide="briefcase" class="w-4 h-4 text-blue-500"></i><p class="text-[10px] font-bold text-blue-200">${tasksCount} pend√™ncias Makro</p></li>`;
        };

        window.toggleServicoFields = () => { 
            const campos = document.getElementById('campos-abastecimento');
            const tipo = document.getElementById('servico-tipo').value;
            if(campos) campos.classList.toggle('hidden', tipo !== 'Abastecimento'); 
        };
        
        window.calcCombustivel = () => { 
            const v = parseFloat(document.getElementById('servico-valor').value); 
            const p = parseFloat(document.getElementById('servico-preco-litro').value); 
            const lit = document.getElementById('servico-litros');
            if(v && p && lit) lit.value = (v/p).toFixed(2); 
        };

        window.onload = async () => {
            await initAuth();
            window.updateModelDropdown();
            // A interface s√≥ atualiza ap√≥s o login via handleLogin
        };
    </script>
</body>
</html>
