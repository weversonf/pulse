<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PULSE OS - Ajustes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-slate-950 text-slate-100 italic">

<div class="flex min-h-screen relative">
    <div id="menu-container"></div>
    <div id="main-content" class="flex-1 md:ml-64 transition-all duration-300 pb-safe-bottom">
        <div id="header-placeholder"></div>

        <main class="max-w-6xl mx-auto p-4 md:p-8 space-y-8 italic">

            <!-- IDENTIDADE -->
            <section class="space-y-4">
                <div class="glass-card p-6 flex items-center gap-6">
                    <div id="avatar-preview-container"
                        class="w-20 h-20 rounded-full bg-slate-950 border border-white/10 flex items-center justify-center overflow-hidden">
                        <i data-lucide="user" class="w-10 h-10 text-blue-500/50"></i>
                    </div>

                    <div class="flex-1">
                        <h2 id="set-user-name"
                            class="text-3xl font-black text-white uppercase tracking-tighter leading-none">
                            CARREGANDO...
                        </h2>
                    </div>
                </div>
            </section>

            <!-- VEÍCULO -->
            <section class="space-y-4">
                <h3 class="text-xs font-black uppercase text-orange-500">Parâmetros do Veículo</h3>

                <div class="glass-card p-6 space-y-6">
                    <div class="grid md:grid-cols-3 gap-4">
                        <select id="set-bike-tipo" onchange="updateBrands(); savePulseSettings()" class="pulse-input">
                            <option value="Moto">Moto</option>
                            <option value="Carro">Carro</option>
                        </select>

                        <select id="set-bike-montadora" onchange="updateModels(); savePulseSettings()" class="pulse-input"></select>

                        <select id="set-bike-modelo" onchange="updateConsumoDefault(); savePulseSettings()" class="pulse-input"></select>
                    </div>

                    <div class="grid md:grid-cols-3 gap-4 pt-4 border-t border-white/5">
                        <input type="number" id="set-bike-km" onchange="savePulseSettings()" class="pulse-input" placeholder="KM Atual">
                        <input type="number" id="set-bike-oleo" onchange="savePulseSettings()" class="pulse-input" placeholder="Troca Óleo">
                        <input type="number" id="set-bike-consumo" onchange="savePulseSettings()" class="pulse-input" placeholder="KM/L">
                    </div>
                </div>
            </section>

            <!-- CAFEÍNA -->
            <section class="space-y-4">
                <h3 class="text-xs font-black uppercase text-emerald-500">Calibragem de Cafeína</h3>

                <div class="glass-card p-6 grid md:grid-cols-3 gap-4">
                    <input type="number" id="set-calib-monster" onchange="savePulseSettings()" class="pulse-input" placeholder="Monster mg">
                    <input type="number" id="set-calib-ml" oninput="autoCalcCaffeine()" onchange="savePulseSettings()" class="pulse-input" placeholder="Caneca ml">
                    <input type="number" id="set-calib-total-mg" readonly class="pulse-input bg-slate-900/40 text-emerald-500">
                </div>
            </section>

            <!-- PROPÓSITO -->
            <section class="space-y-4">
                <h3 class="text-xs font-black uppercase text-purple-500">Configuração do Propósito</h3>

                <div class="glass-card p-6 grid md:grid-cols-3 gap-4">
                    <input type="text" id="set-alcohol-title" onchange="savePulseSettings()" class="pulse-input uppercase" placeholder="Título">
                    <input type="date" id="set-alcohol-start" onchange="savePulseSettings()" class="pulse-input">
                    <input type="number" id="set-alcohol-target" onchange="savePulseSettings()" class="pulse-input" placeholder="Meta Dias">
                </div>
            </section>

        </main>
    </div>
</div>

<script type="module" src="./js/app.js"></script>

<script>
/* ---------- DATABASE VEÍCULOS ---------- */
const VEICULOS_DATABASE = {
    Moto: {
        YAMAHA: { "FAZER 250": 35, "LANDER 250": 32, "MT-03": 22 },
        HONDA: { "CB 300F": 33, "XRE 300": 28, "CG 160": 42 }
    },
    Carro: {
        TOYOTA: { "COROLLA": 12, "HILUX": 10 },
        VW: { "GOL": 13, "POLO": 15 }
    }
};

window.updateBrands = () => {
    const tipo = document.getElementById('set-bike-tipo').value;
    const select = document.getElementById('set-bike-montadora');
    select.innerHTML = "";

    Object.keys(VEICULOS_DATABASE[tipo]).forEach(m => {
        select.add(new Option(m, m));
    });

    updateModels();
};

window.updateModels = () => {
    const tipo = document.getElementById('set-bike-tipo').value;
    const marca = document.getElementById('set-bike-montadora').value;
    const select = document.getElementById('set-bike-modelo');
    select.innerHTML = "";

    if (VEICULOS_DATABASE[tipo][marca]) {
        Object.keys(VEICULOS_DATABASE[tipo][marca]).forEach(mod => {
            select.add(new Option(mod, mod));
        });
    }

    updateConsumoDefault();
};

window.updateConsumoDefault = () => {
    const tipo = document.getElementById('set-bike-tipo').value;
    const marca = document.getElementById('set-bike-montadora').value;
    const modelo = document.getElementById('set-bike-modelo').value;

    const consumo = VEICULOS_DATABASE?.[tipo]?.[marca]?.[modelo];
    if (consumo)
        document.getElementById('set-bike-consumo').value = consumo;
};

window.autoCalcCaffeine = () => {
    const ml = parseFloat(document.getElementById('set-calib-ml').value) || 0;
    document.getElementById('set-calib-total-mg').value = ml > 0 ? Math.round((ml / 100) * 40) : "";
};

/* ---------- FUNÇÃO REATIVA ---------- */
window.fillAjustesForm = () => {
    if (!window.appState) return;

    document.getElementById('set-user-name').innerText = window.appState.login || "USUÁRIO";

    const v = window.appState.veiculo || {};
    const c = window.appState.calibragem || {};
    const p = window.appState.perfil || {};

    document.getElementById('set-bike-tipo').value = v.tipo || "Moto";
    updateBrands();

    if (v.montadora)
        document.getElementById('set-bike-montadora').value = v.montadora;

    updateModels();

    if (v.modelo)
        document.getElementById('set-bike-modelo').value = v.modelo;

    document.getElementById('set-bike-km').value = v.km || "";
    document.getElementById('set-bike-oleo').value = v.oleo || "";
    document.getElementById('set-bike-consumo').value = v.consumo || "";

    document.getElementById('set-calib-monster').value = c.monster_mg || 160;
    document.getElementById('set-calib-ml').value = c.coffee_ml || "";
    autoCalcCaffeine();

    document.getElementById('set-alcohol-title').value = p.alcoholTitle || "ZERO ÁLCOOL";
    document.getElementById('set-alcohol-start').value = p.alcoholStart || "";
    document.getElementById('set-alcohol-target').value = p.alcoholTarget || 30;
};
</script>

</body>
</html>